#제 3장 Azure Migrate


##개요
- Microsoft는 2017년 11월에 Azure Migrate를 도입하여 Azure 서비스 집합을 통합하여 온프레미스 워크로드를 검색, 평가하고 Azure 클라우드로 마이그레이션했습니다. 처음에는 서비스가 VMware VM(가상 머신)을 평가하고 Azure로 마이그레이션하는 것으로 제한되었습니다. 그러나 시간이 지남에 따라 Microsoft는 다음을 포함하여 다양한 워크로드를 마이그레이션할 수 있도록 서비스에 새로운 기능을 추가했습니다.
    - VM
    - 웹 애플리케이션
    - 데이터베이스
    - VM, 데이터베이스 또는 웹 앱과 연결되지 않은 대량의 데이터
    - 온프레미스 또는 공동 배치된(co-located) 데이터 센터 또는 Amazon Web Services(AWS) 또는 Google Cloud Platform(GCP)과 같은 기타 클라우드 서비스에서 실행되는 VDI(가상 데스크톱 인프라)
- Azure Migrate 서비스는 Microsoft에서 제공하는 도구와 워크로드 검색, 평가 및 마이그레이션에 사용되는 통합 타사 솔루션을 중앙 집중화합니다. 현재 타사 솔루션에는 RackWare, Carbonite, Cloudamize 등이 포함됩니다.

##주요 특징들
- **중앙 집중식 마이그레이션 서비스**: Azure Migrate는 워크로드를 검색, 평가 및 Azure로 마이그레이션하기 위해 Microsoft에서 제공하는 다양한 도구를 모두 통합합니다. 이를 통해 모든 마이그레이션을 쉽게 추적, 모니터링 및 관리할 수 있습니다.
- **다양한 워크로드 지원**: Azure Migrate는 VM, 데이터베이스, 웹앱, 데이터 스토리지 및 VDI와 같은 워크로드를 평가하고 마이그레이션하는 기능을 제공합니다.
- **다양한 소스 플랫폼 지원**: Azure Migrate는 Hyper-V, VMware 및 물리적 서버와 같은 다양한 인프라 플랫폼에서 호스팅되는 특정 워크로드에 대한 평가 및 마이그레이션 기능을 제공합니다.
- **다양한 클라우드 플랫폼 지원**: Azure Migrate는 AWS(Amazon Web Services) 및 GCP(Google Cloud Platform)와 같은 다양한 클라우드 플랫폼에서 호스팅되는 특정 워크로드에 대한 평가 및 마이그레이션 기능을 제공합니다.
- **확장성**: ISV(independent software vendors, 독립 소프트웨어 공급업체)라고도 하는 타사 솔루션 공급자의 제품을 사용하여 Azure Migrate 기능을 확장할 수 있습니다. 즉, 마이그레이션 목표를 달성하기 위해 더 편안하거나 사전에 투자한 도구를 사용할 수 있습니다.
- **다양한 서비스로 마이그레이션**: Azure Migrate를 사용하면 워크로드를 Azure VM, Azure SQL Database, Azure SQL Managed Instance, Azure App Service, Azure Virtual Desktop 및 Azure Storage와 같은 다양한 Azure 서비스로 마이그레이션할 수 있습니다. 따라서 마이그레이션을 최적화하고 클라우드 네이티브 솔루션을 사용하여 클라우드 투자를 극대화할 수 있습니다.

평가 도구(Assessment tools)
- **Azure Migrate 검색(Discovery) 및 평가 도구**: 이 도구를 사용하면 온-프레미스 물리적 서버와 Hyper-V 또는 VMware 기반 VM을 검색하고 평가할 수 있습니다. 지속적인 서버 메타데이터 및 성능 데이터를 Azure에 보내는 에이전트 기반 또는 에이전트 없는 평가를 수행하려면 온-프레미스 환경의 VM 또는 물리적 서버에 경량 어플라이언스를 배포해야 합니다. 그런 다음 다음에 대한 명확성을 제공하기 위해 준비 보고서를 생성합니다.
    - 온-프레미스 워크로드가 Azure로 마이그레이션하기 위한 필수 구성 요소를 충족하는지 여부입니다.
    - 워크로드가 마이그레이션 후 사용할 수 있는 예상 크기 및 VM SKU입니다.
    - 마이그레이션 계획에 통합해야 하는 다른 서버와의 관련 종속성.
    - 마이그레이션 후 Azure에서 워크로드를 실행하는 데 드는 예상 비용입니다.
- **Data Migration Assistant**: 이 도구를 사용하면 Azure SQL Database, Azure SQL Managed Instance 또는 Azure VM에서 호스팅되는 SQL Server로 마이그레이션하기 위한 온-프레미스 SQL Server 워크로드를 평가할 수 있습니다. 이는 잠재적인 마이그레이션 장애물, 마이그레이션 접근 방식 및 평가를 기반으로 전략을 식별하여 마이그레이션이 최대한 효율적인지 확인하는 데 도움이 될 수 있습니다.
- **Web App Migration Assistant**: 이 무료 도구를 사용하면 Azure App Service로 마이그레이션하기 위해 온-프레미스 웹 사이트 및 웹 앱을 평가할 수 있습니다. 온-프레미스 .NET, Java 및 Linux 웹앱을 쉽고 자동으로 평가할 수 있는 도구를 제공합니다.

마이그레이션 도구
- **Azure Migrate 서버 마이그레이션 도구**: 이 도구를 사용하면 온-프레미스 물리적 서버와 Hyper-V 또는 VMware 기반 VM을 Azure VM으로 마이그레이션할 수 있습니다. 또한 AWS 및 GCP와 같은 다른 클라우드 서비스에서 호스팅되는 VM의 마이그레이션도 지원합니다. 다양한 소스 플랫폼 각각에 대해 다양한 방법으로 데이터 동기화를 수행할 수 있습니다.
    - **Hyper-V**: VM에 에이전트를 배포할 필요 없이 Hyper-V 호스트 마이그레이션에 설치된 공급자 에이전트를 사용할 수 있습니다.
    - **물리적 서버**: 물리적 서버에는 기존 물리적 서버 인프라의 서버와 함께 AWS, GCP 및 독립형 ESX 호스트에서 호스팅되는 서버가 포함됩니다. 물리적 서버를 마이그레이션하려면 초기 데이터와 데이터 변경 사항을 Azure 클라우드에 동기화하기 위해 온-프레미스 환경에 배포하는 복제 어플라이언스를 사용해야 합니다.
    - **VMware**: 에이전트 없는 접근 방식이나 에이전트 기반 접근 방식을 사용하여 VMware 마이그레이션을 수행할 수 있습니다. 에이전트 없는 접근 방식에서는 검색 및 평가 어플라이언스를 사용하는 반면, 에이전트 기반 접근 방식에서는 온프레미스 환경에 복제 어플라이언스를 배포해야 합니다. VMware 마이그레이션을 위해서는 통합을 위한 vCenter 어플라이언스가 필요합니다. 그렇지 않은 경우 독립 실행형 ESX 호스트의 경우 복제 어플라이언스를 사용하여 물리적 서버와 동일한 접근 방식을 사용하여 마이그레이션을 수행해야 합니다.
    - **Azure Database Migration Service**: 이 도구를 사용하면 가동 중지 시간을 최소화하면서 Azure SQL Database, Azure SQL Managed Instance, Azure VM에서 실행되는 SQL Server, Azure Database for MySQL, Azure Database for PostgreSQL 등 다양한 데이터베이스를 Azure 서비스로 자동 마이그레이션할 수 있습니다.
    - **Web App Migration Assistant**: 평가 기능을 제공하는 것 외에도 이 도구는 온-프레미스 .NET, Java 또는 Linux 웹 앱을 Azure App Service로 이동하는 마이그레이션 기능을 제공합니다.
    - **Azure Data Box**: 이 도구에는 대량의 데이터를 Azure Storage로 마이그레이션하기 위한 Data Box, Data Box Disk, Data Box Gateway 및 Data Box Heavy와 같은 다양한 제품이 포함되어 있습니다.

##배포 개념 및 고려 사항
Azure Migrate 검색(Discovery) 및 평가 도구
- Hyper-V, VMware 또는 물리적 서버에서 호스팅되는 온-프레미스 Windows 또는 Linux 가상 머신의 검색 및 평가를 수행하려면 Azure Migrate 검색 및 평가 도구의 일부인 Azure Migrate 어플라이언스를 배포합니다. 소스 플랫폼에 따라 OVA(Open Virtualization Appliance) 템플릿, Hyper-V VHD 또는 PowerShell 스크립트를 사용하여 어플라이언스를 배포할 수 있습니다. 어플라이언스는 어플라이언스 구성 중에 설정된 vCenter 서버 또는 Hyper-V 호스트를 사용하여 검색을 수행할 수 있으며, 검색 후 평가할 VM을 선택할 수 있습니다. 물리적 서버의 경우 어플라이언스가 쿼리할 수 있도록 관리 자격 증명과 해당 IP 주소/호스트 이름을 정의하고 해당 서버에 연결하여 평가를 수행해야 합니다. AWS 또는 GCP와 같은 다른 솔루션에서 호스팅되는 VM은 물리적 서버와 유사한 검색 및 평가를 위해 설정해야 합니다.
- 각 시나리오에는 검색 및 평가를 위해 어플라이언스가 지원하는 Windows 및 Linux OS 버전 세트가 있습니다. 빌드를 수행할 때 지원되는 최신 릴리스에 대해 공개적으로 사용 가능한 Microsoft 지침을 참조해야 합니다. 이 지침은 다양한 Windows 및 Linux OS 릴리스의 지원 종료 또는 수명 종료에 따라 변경됩니다.
- 하이퍼바이저 OS 버전 지원도 OEM 지원 지침에 따라 정기적으로 업데이트됩니다. 예를 들어 현재 어플라이언스는 Windows Server 2019, Windows Server 2016 및 Windows Server 2012 R2에서 실행되는 Hyper-V 호스트의 사용을 지원합니다. 이보다 이전 버전(예: Windows Server 2012 또는 Windows Server 2008 R2)은 지원되지 않습니다.

팁
- 빌드 시 지원되는 하이퍼바이저 버전을 확인하세요. 현재 하이퍼바이저가 패치되지 않았거나 최신 상태가 아닌 경우 환경에서 어플라이언스를 사용하기 전에 전제 조건이 충족되었는지 확인해야 합니다.
- 어플라이언스는 다음 검색을 수행합니다.
    - 현재 OS 및 패치 수준, CPU 크기, RAM, 디스크, 네트워크 인터페이스 및 기본 하이퍼바이저 기반의 기타 정보 호스트를 포함한 서버 세부 정보가 포함된 검색된 서버의 메타데이터
    - 설치된 소프트웨어, ASP .NET 웹앱, SQL Server 인스턴스 및 데이터베이스
    - 감지(Discovery) 범위에 있는 다양한 온프레미스 서버 간의 종속성(에이전트 없는 종속성 분석을 통해 식별됨)
- 보다 정확한 평가를 위해 설정된 기간 동안 서버에서 성능 데이터를 수집하도록 어플라이언스를 설정할 수 있습니다. 이렇게 하면 해당 서버에 대한 Azure VM 및 디스크 SKU에 적합한 크기를 정확하게 식별하는 데 도움이 됩니다. 평가를 수행하는 기간에 따라 어플라이언스는 데이터 포인트를 수집하여 더 깊은 통찰력을 얻고 신뢰도 등급을 할당하여 크기 권장 사항이 프로덕션 용도에 얼마나 적합한지 이해하는 데 도움을 줍니다. 어플라이언스가 충분한 기간 동안(또는 전혀) 성능 데이터를 수집하지 못한 경우 이 신뢰 등급은 낮습니다.
- 성능 기반 평가를 수행하지 않는 경우 어플라이언스는 서버의 메타데이터 검색 중에 수집된 크기 정보를 사용하여 적절한 크기를 확인합니다.
- 검색된 서버의 메타데이터 및 성능 데이터를 포함하여 어플라이언스에서 수집한 데이터는 HTTPS를 통해 Azure로 전송되고 암호화를 통해 Azure Cosmos DB 및 Azure Storage에 저장됩니다. 즉, 전송 중과 저장 중 모두 암호화됩니다.
- 각 어플라이언스는 수천 개의 VM을 지원할 수 있으며, 이 한도는 Microsoft가 최신 버전을 출시함에 따라 계속해서 확장됩니다. 단일 어플라이언스가 요구 사항을 충족하지 못하는 경우 환경에 여러 어플라이언스를 배포할 수도 있습니다. Hyper-V, VMware 및 물리적 인프라 환경마다 제한이 다르며 배포하는 어플라이언스 버전에 따라 변경될 수 있으므로 어플라이언스가 지원하는 서버 및 호스트 수를 확인하려면 온라인에서 제공되는 최신 지침을 참조하세요.

종속성 분석(Dependency analysis)
- 종속성 분석은 검색된 서버 간의 종속성을 식별하므로 해당 서버를 환경의 다른 관련 서버로 마이그레이션할 때 미치는 영향을 더 잘 이해할 수 있습니다. 이를 통해 다음을 수행할 수 있습니다.
    - 워크로드 마이그레이션을 계획하고 수행할 때 잠재적인 장애물과 중단을 고려하십시오.
    - 마이그레이션 후에도 계속 올바르게 작동하도록 함께 마이그레이션해야 하는 서버 그룹을 분석하고 계획합니다.
    - 더 이상 필요하지 않은 경우 마이그레이션 전에 제거할 수 있도록 인식하지 못한 종속성을 식별합니다.
    - 종속 워크로드를 담당하는 사람을 포함한 모든 이해관계자와 소통하여 더욱 응집력 있는 계획과 마이그레이션을 위해 함께 모일 수 있습니다.
- Azure Migrate는 에이전트 없는 종속성과 에이전트 기반이라는 두 가지 유형의 종속성 분석을 지원합니다. 에이전트 없는 종속성 분석은 vCenter 서버를 사용하는 VMware 기반 환경에 대해서만 지원되며 이 글을 쓰는 시점에는 현재 미리 보기 상태입니다. 현재 에이전트 기반 종속성 분석은 더 광범위한 하이퍼바이저 및 인프라 세트를 다루고 있습니다. 에이전트 기반 접근 방식을 사용하면 다음과 같습니다.
    - 종속성 분석을 수행하려는 모든 온프레미스 서버에 MMA(Microsoft Monitoring Agent) 및 종속성 에이전트를 배포해야 합니다.
    - 에이전트는 소스 및 대상 서버 이름, 프로세스, 애플리케이션 이름, 포트, 연결 수, 대기 시간 및 데이터 전송 정보를 포함하여 각 프로세스에 대한 TCP 프로세스 및 인바운드/아웃바운드 연결에 대한 정보를 수집합니다.
    - Azure Log Analytics를 사용하여 분석하기 위해 데이터는 Azure Cosmos DB 및 Azure Storage에 업로드됩니다. 그런 다음 Azure는 서비스 맵을 사용하여 데이터를 분석하고, Windows 및 Linux 서버에서 애플리케이션 구성 요소를 검색하고, 서버와 서비스 간의 통신 경로를 식별하여 시각화 맵을 만듭니다.
- 인터넷에 연결되지 않은 서버가 있는 경우 Log Analytics 게이트웨이라는 추가 구성 요소를 다운로드하고 설치하여 로컬 데이터를 캡처하고 Microsoft Azure에 업로드해야 합니다. 게이트웨이는 온-프레미스 서버와 Azure 간의 인터페이스 역할을 합니다.

Azure Migrate 서버 마이그레이션 도구
- 검색 및 평가 단계를 성공적으로 완료한 후에는 워크로드 마이그레이션을 시작해야 합니다. 하지만 먼저 마이그레이션의 모든 측면을 포괄하는 마이그레이션 계획을 개발해야 합니다. 여기에는 다음이 포함됩니다.
    - 마이그레이션 전 전략 및 활동
    - 마이그레이션 전략
    - 역할과 책임
    - 마이그레이션 후 Azure 관리 전략
- 계획된 접근 방식을 취하면 마이그레이션 프로젝트의 모든 목표를 성공적으로 달성하는 데 도움이 됩니다.
- 마이그레이션 계획에는 최소한 다음 영역이 포함되어야 합니다. 환경과 조직의 규모와 복잡성에 따라 여기에서 다루지 않은 다른 영역을 계획해야 할 수도 있습니다.
    - **서버 준비(Readiness)**: Azure Migrate 검색 및 평가 도구를 사용하여 생성된 평가 보고서에 따라 모든 서버가 Azure로 마이그레이션할 준비가 되었는지 확인하세요. 마이그레이션 준비가 완료된 것으로 표시되지 않은 모든 서버는 마이그레이션 계획이 완료되기 전에 준비되어야 합니다.
    - **지원 종료(End-of-support) 하드웨어**: 마이그레이션이 완료될 때까지 해당 서버를 지원하기 위해 온프레미스 하드웨어에 투자할 필요가 없도록 지원 종료 하드웨어에 마이그레이션 우선순위를 두는 것이 좋습니다.
    - **지원 종료 소프트웨어**: 마이그레이션을 위해 Azure에서 확장 지원을 포함하는 지원 종료 소프트웨어의 우선 순위를 지정하는 것이 좋습니다. 이는 서버 OS에 대한 확장된 보안 업데이트 및 지원을 얻는 데 도움이 될 수 있습니다. 또한 현재 최신 OS에서 호스팅할 수 없는 레거시 애플리케이션에도 도움이 될 수 있습니다.
    - **서버 크기**: Azure에서 서버 크기를 쉽게 확장하거나 축소할 수 있지만 성능 기반 평가 옵션을 사용하여 서버에 대한 더 깊은 통찰력을 얻어 초기 이동 중에 서버 크기를 더 적절하게 조정할 수 있어야 합니다.
    - **라이선스 분석**: Azure 지출을 줄이는 데 도움이 될 수 있는 라이선스 혜택을 활용하세요. 예를 들어 Azure 하이브리드 사용 혜택을 적용하면 Azure에서 Windows VM을 실행하는 비용을 줄일 수 있습니다. Red Hat 및 SUSE와 같은 다른 OEM은 라이선스 계약에 따라 유사한 혜택을 제공할 수 있습니다.
    - **종속성 평가**: 서버와 서비스의 상호 연결성에 대한 보다 명확한 아이디어를 얻고 마이그레이션 중에 중단이 최소화되도록 하려면 환경에서 종속성 평가를 수행하십시오.
    - **비용 계획(Cost planning)**: Azure 환경과 관련된 비용(평가 보고서 기준)은 예산과 일치해야 합니다. 그러나 특정 서비스 및 구성 요소는 사용량에 따라 요금이 부과되므로 평가 보고서에서는 이를 고려하지 않으므로 편차가 발생할 수 있습니다. 여기에는 VPN 게이트웨이, 방화벽, 애플리케이션 게이트웨이, 대역폭 사용량, VM 백업, 모니터링 등과 같은 네트워킹, 모니터링 및 관리 구성 요소가 포함됩니다.
    - **테스트**: Azure Migrate 서버 마이그레이션 도구를 사용하면 격리된 테스트 환경에서 서버를 온라인으로 전환하여 Azure의 서버를 동기화하고 테스트할 수 있습니다. 이러한 방식으로 현재 워크로드에 영향을 주지 않고 모든 애플리케이션과 서비스가 Azure에서 필요에 따라 작동하는지 확인할 수 있습니다.
    - **관리자 교육(Training)**: 관리 교육을 마이그레이션 전략에 통합하여 IT 팀이 마이그레이션 후 서버 및 관련 Azure 인프라를 관리할 수 있도록 준비하세요.
- Azure Migrate 서버 마이그레이션 도구는 온-프레미스 서버를 Azure VM으로 마이그레이션하기 위한 기본 도구입니다. 이 도구는 에이전트 없는 마이그레이션과 에이전트 기반 마이그레이션이라는 두 가지 마이그레이션 옵션을 제공합니다.
- 에이전트 없는 마이그레이션은 VMware(vCenter 통합 포함) 및 Hyper-V 기반 마이그레이션에만 지원됩니다. Hyper-V 마이그레이션의 경우 에이전트 없는 복제 프로세스를 관리하기 위해 복제 공급자가 Hyper-V 호스트에 설치됩니다. 서버가 IOPS 제한 환경에서 실행되는 시나리오에서는 에이전트 없는 마이그레이션 옵션을 사용하지 않는 것이 좋습니다. 에이전트 없는 마이그레이션은 하이퍼바이저 기반 스냅샷을 사용하여 델타 변경 사항을 정기적으로 식별하고 Azure에 복사하기 때문에 IOPS가 이미 제한된 환경에서 성능이 저하될 수 있기 때문입니다.
- 에이전트 기반 마이그레이션은 VMware 및 Hyper-V 기반 VM, 물리적 서버, AWS 및 GCP VM, XenServer 기반 VM 등을 포함한 모든 유형의 마이그레이션에 적합합니다. 이 접근 방식은 복제에 하이퍼바이저 기술을 사용하지 않으므로 에이전트에 대한 전제 조건이 충족되는 한 모든 워크로드를 동기화하는 데 사용할 수 있습니다. Azure에 대한 서버 준비 상태를 측정하는 데 사용되는 Azure Migrate 검색 및 평가 도구는 이러한 필수 구성 요소를 분석합니다.
- 에이전트 없는 마이그레이션 접근 방식에서 Azure Migrate 검색 및 평가 어플라이언스는 Azure에 대한 에이전트 없는 데이터 복제를 처리합니다. 에이전트 기반 마이그레이션 접근 방식에서는 복제 어플라이언스를 온프레미스에 배포해야 하며, 이 어플라이언스를 사용하여 복제할 모든 서버에 에이전트를 배포해야 합니다.
- 복제(Replication) 어플라이언스에는 서로 다른 작업을 처리하기 위해 함께 작동하는 여러 구성 요소가 있습니다.
    - 온-프레미스 서버와 통신하고 복제 관련 데이터를 수집하여 Azure Storage로 보냅니다.
    - Azure로의 데이터 전송을 위한 복제 게이트웨이 역할을 합니다.
    - Azure에 대한 연결이 중단되는 경우 데이터 캐싱을 수행합니다.
    - Azure로 전송하기 전에 데이터 압축 및 암호화를 수행합니다.
    - 데이터 복제를 설정할 수 있도록 필요한 서버에 모바일 서비스 에이전트 소프트웨어의 푸시 설치를 수행합니다.
- OVA 템플릿을 사용하거나 물리적 서버 또는 VM에 복제 소프트웨어를 다운로드하고 설치하여 어플라이언스를 배포할 수 있습니다. 배포를 시작하기 전에 어플라이언스 전제 조건이 충족되었는지 확인하십시오.
- Microsoft는 정기적으로 어플라이언스를 업데이트하고 Azure Migrate 허브에 업데이트된 설치 관리자를 제공합니다. 어플라이언스 업데이트를 자동화하거나 수동으로 수행할 수 있습니다. 어플라이언스를 수동으로 업데이트하려는 경우 지속적으로 이를 수행할 수 있는 프로세스를 마련해야 합니다. Microsoft에서는 항상 최신 버전의 복제 소프트웨어를 사용할 것을 권장합니다.

네트워킹
- Azure Migrate는 모든 시나리오에서 공용 인터넷을 사용한 복제를 지원합니다. 데이터는 암호화된 HTTPS 채널을 통해 구성한 Azure Storage 엔드포인트로 전송됩니다. 복제 어플라이언스, 평가 어플라이언스 및 Hyper-V 호스트는 모두 아웃바운드 복제 데이터를 Azure로 보낼 수 있도록 다양한 Azure URL에 대한 포트 443 연결이 필요합니다. 서버에 필요한 네트워크 액세스 권한이 있는지 확인하려면 Microsoft에서 제공하는 업데이트된 URL 목록을 확인하세요.
- ExpressRoute 또는 VPN 게이트웨이를 통한 Azure Private Link 조합을 사용하는 개인 연결을 통한 데이터 동기화는 이 글을 쓰는 시점의 특정 지역에서 미리 보기로 도입되었습니다. 이는 사용자 환경에 대해 Azure Migrate 서비스를 테스트하거나 사용하기로 결정할 때 변경될 수 있습니다.

스케일링
- 대규모 환경에서는 여기에 설명된 대로 소스 플랫폼과 환경에 대해 선택한 복제 접근 방식에 따라 검색, 평가 및 복제를 확장할 수 있습니다.

발견(Discovery) 및 평가(Assessment)
- Hyper-V 환경에서 검색 및 평가에 사용되는 각 Azure Migrate 어플라이언스는 300개의 Hyper-V 호스트에 연결할 수 있으며 최대 5,000개의 VM을 검색하고 평가할 수 있습니다. 더 많은 용량이 필요한 경우 전체 환경 요구 사항에 따라 추가 Azure Migrate 어플라이언스를 배포할 수 있습니다.
- VMware 환경에서 검색 및 평가에 사용되는 각 Azure Migrate 어플라이언스는 단일 vCenter 서버에만 연결할 수 있으며 최대 10,000개의 VM을 검색하고 평가할 수 있습니다. 더 많은 용량이 필요한 경우 전체 환경 요구 사항에 따라 추가 Azure Migrate 어플라이언스를 배포할 수 있습니다.
- 물리적 서버 환경(AWS, GCP 및 기타 하이퍼바이저 포함)에서 검색 및 평가에 사용되는 각 Azure Migrate 어플라이언스는 최대 1,000개의 서버를 검색하고 평가할 수 있습니다. 더 많은 용량이 필요한 경우 전체 환경 요구 사항에 따라 추가 Azure Migrate 어플라이언스를 배포할 수 있습니다.

복제 및 마이그레이션
- Hyper-V 호스트에 Hyper-V 복제 공급자(Replication provider) 서비스를 배포하여 Hyper-V 환경에서 에이전트 없는 복제를 구현합니다. 확장 시나리오에서는 개별 Hyper-V 호스트에 설치된 공급자 서비스를 사용하여 VM이 복제되므로 일반적으로 문제가 발생하지 않습니다. 추가 VM이 있는 더 많은 호스트가 추가되면 호스트에 공급자 에이전트를 설치하면 용량이 자동으로 확장됩니다. Hyper-V 호스트가 VM 하위 집합에 대한 복제 로드를 처리할 수 없는 경우 해당 VM은 복제를 위해 대체 Hyper-V 호스트로 이동해야 합니다.
- 에이전트 기반 Hyper-V 복제에서 VM은 물리적 서버로 처리되며 기본 복제 어플라이언스를 배포해야 합니다. 확장 시나리오에서는 확장 어플라이언스를 추가하여 기본 구성 및 복제 서버와 함께 작동할 수 있습니다. 각 어플라이언스는 한 번에 복제를 위해 최대 200개의 VM을 지원합니다. 이 제한은 최신 버전의 어플라이언스에서 증가하고 있습니다.
- 에이전트 없는 VMware 복제(단일 vCenter 서버 포함)는 환경 평가를 위해 배포된 마이그레이션 어플라이언스를 사용합니다. 기본 마이그레이션 어플라이언스는 한 번에 최대 300개의 VM을 지원합니다. 크기 조정 시나리오에서는 환경에 배포한 기본 Azure Migrate 어플라이언스에 연결된 확장 마이그레이션 어플라이언스를 추가할 수 있습니다. 이 접근 방식을 사용하면 현재 제한 사항에 따라 최대 500개의 VM을 동시에 마이그레이션할 수 있습니다.
- 에이전트 기반 VMware 복제에는 기본 복제 장치를 배포해야 합니다. 이 어플라이언스는 한 번에 50 ~ 100개의 VM을 지원합니다. 확장 시나리오에서는 기본 복제 어플라이언스에 연결된 확장 복제 어플라이언스를 추가할 수 있습니다. 이 접근 방식은 확장 서버당 50 ~ 100개의 추가 VM을 동기화하는 데 도움이 될 수 있습니다.
- 에이전트 기반 물리적 서버 마이그레이션(AWS, GCP 및 기타 하이퍼바이저 포함)에는 기본 복제 어플라이언스 배포가 필요합니다. 이 어플라이언스는 한 번에 50 ~ 100개의 VM을 지원합니다. 확장 시나리오에서는 기본 복제 어플라이언스에 연결된 확장 복제 어플라이언스를 추가할 수 있습니다. 이 접근 방식은 확장 서버당 50 ~ 100개의 추가 VM을 동기화하는 데 도움이 될 수 있습니다.

##모범 사례
- **검색 및 평가(Discovery and assessment) 수행**: 검색 및 평가는 모든 마이그레이션에서 중요한 단계입니다. 이를 통해 IT는 서버 OS, 하이퍼바이저 버전 등에 따른 서버 준비 부족과 같은 잠재적인 장애물을 고려하여 마이그레이션을 명확하게 식별하고 계획할 수 있습니다. 초기 현황 평가 보고서에서도 마이그레이션된 서버에 사용할 예상 VM 크기와 디스크 유형에 대한 기본 정보를 제공합니다.
- **Azure로 마이그레이션할 서버에 대한 성능 기반 평가 생성**: 서버에 대한 복제를 설정하기 전에 보다 정확한 크기와 디스크 매개 변수를 식별하는 데 도움이 될 수 있습니다.
- **종속성 분석 수행**: 더 크고 복잡한 환경에서 종속성 분석을 수행하면 상호 연결된 워크로드에 대한 마이그레이션을 더 효과적으로 계획하고 실행할 수 있으므로 마이그레이션 중 오류와 가동 중지 시간을 크게 줄일 수 있습니다. 여러 서버에 걸쳐 호스팅되는 수많은 애플리케이션과 데이터베이스가 있는 경우 종속성 분석은 중소 규모 환경에도 도움이 될 수 있습니다.
- **평가(Assessment)에 대한 신뢰 등급(Confidence ratings)이 높은지 확인**: 신뢰 등급은 Azure Migrate 온-프레미스 어플라이언스를 사용하여 Azure Migrate가 수집할 수 있는 데이터 요소 수를 기반으로 합니다. 신뢰 등급이 높을수록 수행할 수 있는 서버, 디스크 용량 및 성능 계획이 더 정확해집니다. 더 나은 분석을 위해 더 많은 데이터 포인트를 수집하려면 적어도 일주일 동안 성과 기반 평가를 실행하십시오.
- **라이선스 옵션 및 혜택 검토**: 다양한 OEM 라이선스 계약을 통해 마이그레이션 후 서버 워크로드 비용을 크게 줄일 수 있습니다. 이러한 이점을 활용하려면 기존 라이선스에 어떤 옵션을 사용할 수 있는지 검토하고 이해하십시오. 가능하다면 OEM에 문의하여 조직에서 사용할 수 있는 옵션에 대해 더 깊은 통찰력을 얻으십시오.
- **모든 비즈니스, 애플리케이션 및 IT 이해관계자와 함께 세부 계획 워크숍을 수행**: 이를 통해 협업 방식으로 마이그레이션을 계획하고 실행할 수 있습니다. 이러한 워크숍은 내부 조정을 보장하고 공동 계획 부족으로 인해 알려졌으나 설명되지 않은 고려 사항으로 인해 마이그레이션이 실패할 위험을 줄이는 데 도움이 될 수 있습니다.
- **마이그레이션 테스트**: Azure Migrate를 사용하면 격리된 Azure 환경에서 마이그레이션을 테스트할 수 있습니다. 이 기능을 사용하여 서버와 서비스 간의 상호 연결이 Azure 클라우드에서 작동하는지 확인하세요. 이는 구성 파일의 IP 주소 참조와 같은 수동 개입 영역을 식별하고 해결하고 자동화하기 위해 마이그레이션하기 전에 온프레미스 환경의 변경을 계획하는 데 도움이 될 수 있습니다.

#제 4장 Azure Monitor

##개요
- Microsoft는 Azure에 애플리케이션을 배포하는 클라이언트에게 각 애플리케이션의 성능에 대한 심층적인 통찰력을 제공하기 위해 2015년 4월 공개 미리 보기로 Application Insights를 출시했습니다. 2016년 9월, Microsoft는 Azure Monitor를 공개 미리 보기로 출시했습니다. 처음에 Azure Monitor에는 활동 로그, 리소스 메트릭 및 진단 로그를 수집, 모니터링(공유 대시보드 사용), 분석 및 경고하는 기능이 포함되었습니다.
- 시간이 지남에 따라 Microsoft는 Application Insights, Log Insights 및 Azure 리소스 모니터링을 Azure Monitor에 통합했습니다. 또한 Microsoft는 Azure Monitor의 기능, 타사 통합, 사용 가능한 메트릭 및 Azure 리소스 전반의 통합을 확장했습니다.

##주요 혜택(Key benefits
- Azure Monitor를 사용하면 모든 Azure 애플리케이션, VM(가상 머신) 및 기타 배포된 서비스를 모니터링할 수 있습니다. 다음과 같은 다양한 주요 이점을 제공합니다.
    - Azure 리소스의 자동화된 로그 수집 및 모니터링
    - 최적화를 위한 애플리케이션 성능에 대한 심층적인 통찰력
    - 조치를 위해 리소스 소유자에게 자동 알림 전송
    - 지속적인 모니터링을 위한 DevOps 통합
    - 중요한 문제를 해결하기 위한 자동화된 조치
    - 선불 투자(Upfront investment)가 필요 없는 종량제 방식(Pay-as-you-go)
    - 모든 요구 사항을 충족하는 맞춤형 대시보드
    - 조직 전체의 중앙 집중식 대시보드를 위해 Power BI 등 다른 Microsoft 서비스와 통합
    - 기능 확장을 위한 상당한 타사 통합
- 그림은 Azure Monitor의 주요 기능에 대한 높은 수준의 개요를 제공합니다. 보시다시피 Azure Monitor는 로그, 이벤트 및 메트릭 수집을 위한 다양한 데이터 원본의 통합을 지원합니다. 다양한 Azure 리소스에 대한 심층적인 통찰력을 얻고, 다양한 기본 제공 도구와 통합 서비스를 사용하여 시각화를 만들고, 데이터를 분석하여 경고 및 자동화된 작업으로 대응하고, 사용자 환경에 있을 수 있는 다른 타사 솔루션으로 데이터를 내보낼 수 있습니다.

<img src="https://drive.google.com/uc?id=16I2TpqoKaaLL2i6KgrLZhG2ueUFGn6__">

##개념 및 고려 사항
데이터 유형
- Azure Monitor는 다음과 같은 세 가지 데이터 형식을 지원합니다.
    - 측정항목(Metrics)
    - 로그 데이터
    - 분산 추적(Distributed traces)

측정항목(Metrics)
- 측정항목은 특정 시점에 수집된 리소스 값으로, 모니터링되는 서비스 또는 이벤트에 대한 시스템 성능을 나타냅니다. 데이터 및 타임스탬프, 지표 이름, 지표를 정의하는 데 도움이 되는 레이블을 포함하는 관련 값과 함께 이러한 숫자 값이 캡처되는 간격을 정의합니다. 메트릭은 성능 병목 현상이나 리소스에 대한 심층적인 분석이 필요한 영역을 식별하기 위해 분석할 수 있는 추세를 나타내는 데 도움이 됩니다.
- Azure는 시계열 데이터베이스를 사용하여 메트릭을 저장하고 최적화합니다. 이러한 유형의 데이터베이스는 이러한 종류의 데이터를 호스팅하는 데 가장 적합하기 때문입니다. 로그와 같은 다른 데이터 유형과 결합하면 문제의 근본 원인을 더 잘 식별할 수 있습니다. 지표는 경량 데이터 포인트이므로 환경에 중요한 리소스의 실시간 상태 모니터링을 위해 대시보드에서 사용하기에 이상적입니다.

<img src="https://drive.google.com/uc?id=1laW-jvABvx0iMvKuUh2Wq3RRkNs97kFw">

로그 데이터
- VM, 스토리지, 네트워크 인프라 및 기타 Azure 서비스를 포함한 모든 시스템은 변경 사항, 문제 및 오류를 캡처하는 로그를 생성합니다. 로그에는 숫자 또는 텍스트 데이터가 포함될 수 있습니다. Azure의 컨텍스트에서는 Log Analytics 작업 영역에 로그를 저장하고 Azure Monitor를 사용하여 관심 있는 특정 이벤트나 오류를 분석할 수 있습니다. 또한 로그 데이터에 대한 쿼리를 수행하여 문제의 근본 원인을 식별하거나 해결 조치를 위해 문제를 사전에 방지할 수도 있습니다. 마지막으로, 사용자가 영향을 받기 전에 문제에 사전에 대응하는 데 도움이 되는 기록된 데이터에 대한 경고를 설정할 수 있습니다.
- Logs는 근본 원인 분석 및 오류 모니터링에 이상적입니다.

<img src="https://drive.google.com/uc?id=19Tb0fwiEWparfm26zeG3VTi0FlSsO39t">

분산 추적
- 분산 추적은 시스템이 분산 환경 전체에서 사용자 요청을 추적하고 환경의 병목 현상이나 기타 문제를 식별하고 분석하는 데 사용됩니다. 분산 시스템에는 다수의 개별 구성 요소가 포함되어 있습니다. 분산 추적은 애플리케이션 스택의 이러한 개별 구성 요소에서 생성된 로그를 상호 연결하는 데 도움이 됩니다. Application Insights SDK를 사용하여 분산 추적을 활성화하고 추적 데이터를 저장할 위치를 정의합니다. 그런 다음 다른 로그 데이터와 함께 추적 데이터를 분석하고 모니터링을 위한 대시보드, 사용자 지정 쿼리 및 경고를 만들 수 있습니다.

데이터 수집
- Azure Monitor는 다음을 포함하여 다양한 데이터 원본을 지원합니다.
    - **구독 수준 활동 및 모니터링 로그**: Azure는 모든 리소스에 대해 수행하는 기타 운영 및 관리 활동과 함께 리소스 생성, 수정 및 삭제를 추적하는 구독 수준 활동 로그를 수집합니다.
    - **Azure 서비스 수준 모니터링 로그**: 이는 새 구독 및 Azure 테넌트를 생성할 때 Microsoft에서 구축하고 관리하는 Azure Active Directory와 같은 서비스에 적용됩니다. 이러한 로그는 이러한 서비스의 상태를 추적하는 데 도움이 됩니다.
    - **리소스 수준 메트릭 및 로그**: Azure는 메트릭을 수집하고 Azure 구독에서 생성하는 모든 리소스에 대한 로그를 수집할 수 있도록 해줍니다. 이는 Azure 구독 내에서 생성된 개별 리소스의 성능과 상태를 추적합니다.
    - **Azure 게스트 VM OS 성능 및 진단 로그**: Azure에서 VM을 만든 후 Azure Monitor를 사용하여 기본 성능 로그를 수집할 수 있습니다. VM에 Azure Monitor 에이전트를 설치하여 자세한 성능 메트릭, 로그 및 이벤트를 캡처하여 VM에 대한 더 깊은 통찰력을 얻을 수도 있습니다.
    - **온-프레미스 VM/서버 또는 기타 클라우드 호스팅 게스트 VM 성능 및 진단 로그**: Azure VM과 마찬가지로 온-프레미스 또는 다른 클라우드 환경에서 호스팅되는 VM 또는 서버에 Azure Monitor 에이전트를 설치하여 모니터링 및 모니터링할 성능 및 진단 로그를 수집할 수 있습니다. 해당 리소스를 관리합니다.
    - **애플리케이션 성능 메트릭 및 진단 로그**: Application Insights를 사용하면 모니터링, 분석 및 경고를 위해 광범위한 성능 및 로깅 데이터를 Azure Monitor로 보낼 수 있습니다. 여기에는 페이지 보기, 애플리케이션 요청, 런타임 중에 발생한 애플리케이션 예외 등 세부적인 정보가 포함됩니다.
    - **사용자 지정 소스**: Azure Monitor는 Data Collector API를 사용하여 모든 REST 클라이언트에서 데이터 수집을 지원합니다. 이를 통해 Azure Monitor 에이전트 사용 또는 Application Insights와의 통합을 지원하지 않는 리소스를 모니터링할 수 있습니다.
- 수집된 후에는 이러한 모든 원본의 데이터를 Azure Monitor 메트릭 데이터베이스 및/또는 Log Analytics 작업 영역 데이터베이스에 직접 쓸 수 있습니다. 또는 이 데이터를 Azure Storage 계정에 저장할 수 있습니다. 그런 다음 Azure Monitor는 거기에서 이를 수집할 수 있습니다.
- Azure Monitor는 데이터 수집을 위한 다양한 방법을 지원합니다.
    - **Application Insights**: Application Insights에서는 풍부한 사용자 및 애플리케이션 데이터, 로그 및 메트릭을 수집하기 위해 Application Insights SDK를 사용하여 애플리케이션을 서비스와 통합해야 합니다.
    - **VM 및 물리적 서버의 에이전트**: VM 또는 물리적 서버에 Log Analytics 또는 Azure Monitor 에이전트를 배포하여 성능, 로그 및 이벤트에 대한 더 깊은 통찰력을 수집할 수 있습니다.
    - **Azure 리소스에 대한 진단 설정**: Azure Storage, Log Analytics 작업 영역, Azure Event Hubs 또는 통합 파트너 솔루션과 같은 다양한 대상으로 로그 및 메트릭을 보내는 Azure 리소스에 대한 진단 설정을 정의할 수 있습니다.

데이터 분리
- Azure Monitor는 다양한 유형의 데이터를 수집할 수 있습니다. 그러나 쉽게 검색할 수 있을 뿐만 아니라 클라이언트, 리소스 및 환경 간의 데이터 분리를 유지하려면 이러한 다양한 유형의 데이터를 모두 논리적 구조로 구성해야 합니다.
- Azure Monitor 서비스에 기본 제공되는 데이터 분리 논리는 모든 데이터에 연결된 작업 영역으로 태그가 지정되고 전체 데이터 수명 주기 동안 모든 태그가 보존되도록 보장합니다. 모든 클라이언트 테넌트에는 서비스에서 사용되는 Azure 지역의 스토리지 클러스터에 전용 데이터베이스 인스턴스가 있습니다.
- Azure Monitor는 ISO/IEC 27001, PCI DSS, HIPAA, HITECH 등의 국제 표준을 준수합니다. 최신 인증 목록을 보려면 Microsoft 보안 센터(Trust Center)를 참조하세요. 여기에서 서비스가 조직에서 요구하는 기타 특정 규정 준수 조치를 준수하는지 여부를 확인할 수 있습니다.

데이터 보존(Retension)
- Azure Monitor 서비스는 선택한 가격 책정 계층에 따라 인덱싱된 모든 로그 데이터와 수집된 메트릭을 유지합니다.
    - **무료 계층**: 이 계층에서는 수집되고 인덱싱된 모든 데이터가 7일 동안 보관됩니다.
    - **유료 계층**: 이 계층에서는 수집되고 인덱싱된 모든 데이터가 기본적으로 31일 동안 유지됩니다. 730일까지 연장할 수 있습니다.
- 빠른 검색을 위해 지난 2주간의 모든 데이터는 SSD 캐시에 저장됩니다.

데이터 중복성(Redundancy)
- 모든 데이터는 LRS(로컬 중복 스토리지)를 사용하여 로컬 Azure 지역 내에서 복제되므로 환경에 일정 수준의 중복성을 제공합니다.

데이터 보안(Security)
- 기본적으로 Azure Monitor는 TLS 1.2 암호화 연결을 통해 Azure 서비스 및 리소스에서 데이터를 수집합니다. 또한 SSD 캐시에 보관된 모든 데이터와 마찬가지로 모든 데이터는 저장 시 암호화됩니다. 이를 통해 모든 단계에서 데이터가 보호됩니다. 전체 데이터 수명주기 동안 공격에 취약한 영역이 없습니다.
- 미사용 암호화된 데이터는 Microsoft 관리 키를 사용하지만 고객은 자신의 키를 사용할 수 있습니다.
- 데이터가 서비스에 의해 수집되면 데이터베이스에 읽기 전용으로 저장됩니다. Azure Monitor API를 사용하여 데이터를 삭제할 수 있지만 변경할 수는 없습니다. 데이터가 삭제되는 것을 원하지 않는 경우 데이터 삭제를 방지하도록 설정된 Azure Storage 계정으로 내보낼 수 있습니다.

데이터 시각화
- Azure Monitor는 다양한 Azure 리소스를 한 눈에 모니터링할 수 있는 두 가지 유형의 기본 제공 시각화, 즉 선별된 시각화와 통찰력을 제공합니다.

선별된(Curated) 시각화
- 선별된 시각화는 범위가 특정 서비스 또는 서비스 집합으로 제한됩니다. 먼저 구성하지 않고도 사용할 수 있습니다. 선별된 시각화의 예로는 VM 또는 Azure Storage 계정과 같은 특정 Azure 리소스를 클릭할 때 표시되는 메트릭이 포함됩니다.

<img src="https://drive.google.com/uc?id=1VSwM48quXt7r7G7MTQ0PLfV5pqwTg8zr">

<img src="https://drive.google.com/uc?id=18yxcoP-c2YAeBBhh5P3ETd-aPu1uL_U5">

통찰력(Insights)
- Insights는 웹앱, VM, 컨테이너 서비스와 같은 특정 리소스에 초점을 맞춘 더 확장 가능한 시각화입니다. 이를 위해서는 통합과 맞춤화가 필요하지만 더 깊고 풍부한 통찰력을 제공합니다. Microsoft는 Application Insights, Container Insights, VM Insights, Network Insights, Storage Insights 등을 포함한 여러 Insights 도구를 제공합니다. 환경을 모니터링하는 데 도움이 될 수 있는 4가지 통찰력은 다음과 같습니다.
    - **Application Insights**: Application Insights는 통합 웹 애플리케이션의 성능, 가용성, 사용량, 병목 현상 및 예외에 대한 심층적인 이해를 제공합니다. 웹 애플리케이션은 온프레미스 및 기타 클라우드 환경을 포함하여 어디에서나 호스팅될 수 있습니다. Application Insights SDK를 사용하여 웹 애플리케이션에 대해 Application Insights 구성을 활성화하고 분석을 위해 필요한 매개 변수를 Azure Monitor로 모니터링하고 스트리밍하도록 구성합니다. Application Insights는 Visual Studio와 통합되어 DevOps 시나리오를 지원합니다.
    - **VM Insights**: VM Insights를 사용하면 수많은 VM의 성능과 상태를 한 번에 모니터링하고 특정 VM의 성능에 영향을 미치는 외부 끝점에 대한 종속성을 식별할 수 있습니다. Azure, 온-프레미스 또는 기타 클라우드 환경에서 호스팅되는 VM에 대해 VM Insights를 사용할 수 있습니다.
    - **Network Insights**: Network Insights는 VPN 게이트웨이, VPN 연결, 개인 끝점, 가상 네트워크 등을 포함하여 사용자 환경에서 실행되는 다양한 네트워크 끝점의 상태를 모니터링합니다. Network Insights를 사용하여 다양한 NSG(네트워크 보안 그룹)에 대한 연결 상태 및 트래픽 흐름 로그를 모니터링할 수도 있습니다.

<img src="https://drive.google.com/uc?id=1QRHSeQNOnaLRTgmFBgn4HHcgGkgWYePK">


- **Storage Insights**: Storage Insights는 Azure 구독에서 실행되는 다양한 스토리지 계정의 상태를 모니터링합니다. Storage Insights를 사용하면 다음과 같은 주요 지표를 쉽게 모니터링할 수 있습니다.
    - 업무(Transactions)
    - 거래시한(Transactions Timeline)
    - E2E 처리시간(E2E Latency)
    - 서버 대기 시간(Server Latency)
    - 클라이언트 오류(Client Errors)
- 다양한 스토리지 계정의 냄비를 모니터링하여 최대 강도 값에 도달하는 계정을 사전에 식별할 수 있습니다. 그림은 Storage Accounts Insights 대시보드를 보여줍니다.

<img src="https://drive.google.com/uc?id=1ufj1listL5FF8i5ngdkO62dWUokJkzqH">

대시보드
- Azure를 사용하면 다양한 데이터 원본과 데이터 유형을 사용하여 사용자 지정 대시보드를 구축하고 쉽게 볼 수 있도록 Azure Portal에 표시할 수 있습니다. 또한 사용자 지정 대시보드를 다른 Azure 사용자와 공유하여 IT 팀 전체에서 중요한 리소스에 대한 일관된 보기를 제공할 수 있습니다. 기본적으로 대시보드를 만들 때 표시할 다양한 데이터 소스의 다양한 데이터 유형이 포함된 타일을 선택합니다. 그런 다음 요구 사항에 따라 크기를 조정하고 정렬할 수 있습니다.

<img src="https://drive.google.com/uc?id=108IVBAtccApIkY6Yrg45lnM2GYCHXmhk">

- 그림은 다음 정보가 포함된 샘플 대시보드를 보여줍니다.
    - 테넌트에 있는 모든 리소스
    - 일부 VM에서 소비되는 평균 CPU 크레딧
    - 해당 VM에 사용 가능한 평균 메모리(바이트)
    - 해당 VM의 평균 CPU 백분율 사용량
    - 지난 며칠 동안의 사용자 로그인 그래프
    - 보안 점수 측정항목
    - 서비스 상태 및 Marketplace 바로가기 타일

통합 문서(Workbooks)
- Azure 통합 문서를 사용하면 여러 데이터 원본에서 풍부한 대화형 시각적 보고서를 생성할 수 있습니다. 주요 지표를 포함하도록 사전 구성된 공개적으로 사용 가능한 템플릿을 기반으로 이러한 보고서를 기반으로 하거나 빈 캔버스로 시작하여 직접 만들 수 있습니다. 필요에 따라 템플릿을 사용자 정의, 저장 및 재사용할 수 있습니다. 그림은 공개적으로 사용 가능한 템플릿 목록을 보여주고, 성능 분석 템플릿의 출력을 보여줍니다.

<img src="https://drive.google.com/uc?id=1N1jyDJmEnJOReU5i_jnUnvp9oKv0t0QN">

<img src="https://drive.google.com/uc?id=1_SPonpGmxj7H1eFbdqPM6SlULagaK_eJ">

Power BI
- Microsoft는 Power BI를 Azure Monitor와 통합했습니다. 따라서 Azure Monitor의 로그를 Power BI로 쉽게 가져와서 풍부한 대화형 시각화를 만들 수 있습니다. 본격적인 비즈니스 분석 서비스인 Power BI는 조직의 요구 사항에 따라 쿼리, 사용자 지정 대시보드 및 보고서를 생성할 수 있는 광범위한 기능을 제공합니다.

타사 통합
- Azure Monitor는 여러 유형의 타사 솔루션과 통합됩니다. 예를 들어:
    - **ITSM(IT service-management) 솔루션**: Azure를 ITSM 도구에 연결하여 자동으로 티켓을 만들고 티켓의 수명 주기를 관리할 수 있습니다. Microsoft 사이트에는 지원되는 ITSM 제품의 광범위한 목록이 포함되어 있으며 더 많은 통합이 온라인에 제공됨에 따라 계속해서 늘어나고 있습니다.
    - **Azure Monitor 파트너 통합**: Azure Monitor는 파트너 솔루션과의 통합을 지원하여 Azure Monitor에서 제공하는 기능을 확장하거나 Azure Monitor에 저장된 로그를 해당 시스템으로 내보냅니다.

데이터 내보내기
- Azure Monitor는 Event Hubs 및 Logic Apps와 같은 다른 Azure 서비스와 통합되어 데이터를 다른 Azure 서비스나 SIEM 또는 모니터링 도구와 같은 타사 솔루션으로 내보냅니다. 직접 통합 및 데이터 내보내기를 위해 서비스에서 노출하는 API와 통합할 수도 있습니다. 다음은 명심해야 할 몇 가지 사항입니다.
    - Azure Monitor와 함께 Logic Apps를 사용하는 경우 Azure Monitor에서 데이터를 내보내고 다른 서비스 또는 솔루션으로 가져오는 자동화된 작업 및 워크플로를 설정할 수 있습니다.
    - Azure Event Hubs를 사용하면 Azure Monitor 데이터를 타사 SIEM 및 모니터링 도구로 변환, 저장 및 스트리밍할 수 있습니다.
    - Azure Monitor에서 제공하는 API를 활용하면 캡처된 모든 로그와 Azure Monitor에서 생성된 메트릭 및 경고를 읽고 분석을 위해 기존 모니터링 솔루션 또는 SIEM 도구로 가져올 수 있습니다.

경고(Alerts)
- 경고는 모든 모니터링 솔루션의 핵심 기능입니다. 필요한 모든 데이터를 수집하고, 모니터링할 모든 이벤트와 메트릭을 식별하고, 환경의 문제를 정확하게 식별하기 위한 적절한 임계값을 선택한 후에는 이벤트가 트리거되고 메트릭 임계값이 충족될 때 이를 알려주는 메커니즘이 필요합니다. Azure Monitor에서는 이 메커니즘이 경고입니다.
- Azure Monitor를 사용하면 대상 리소스, 대상 메트릭 또는 이벤트, 임계값 및 빈도를 식별하여 지정한 일부 작업을 시작할지 여부를 결정하는 경고 규칙을 정의할 수 있습니다. 작업은 작업 그룹의 일부로 정의됩니다. 여기에는 리소스 중지, 시작 또는 다시 시작과 같이 경고를 해결하기 위한 자동화된 작업이 포함될 수 있습니다. 리소스를 확장하거나 축소합니다. 자동화 Runbook을 트리거합니다. 또는 통합 ITSM 도구에 티켓을 기록합니다. 이러한 자동화된 작업과 함께 전자 메일, SMS 또는 음성 통화를 통해 담당 관리자에게 자동화된 작업이 올바르게 수행되었는지 확인하기 위해 수동 개입 또는 모니터링이 필요함을 알리는 작업 그룹과 같은 다른 작업 그룹을 정의할 수도 있습니다.

##모범 사례
- **Azure Monitor 에이전트를 배포하거나 마이그레이션**: 레거시 Log Analytics 에이전트 대신 Windows 및 Linux VM에서 Azure Monitor 에이전트를 사용하세요. Log Analytics 에이전트는 2024년 8월에 사용 중지됩니다. 그래도 가능한 한 빨리 최신 에이전트로 마이그레이션하는 것이 좋습니다. 하지만 먼저 현재 사용하고 있는 모든 모니터 솔루션을 평가해 보십시오. 호환되는 경우 Microsoft는 새 에이전트 설치에 사용할 수 있는 모든 새로운 Azure Monitor 기능을 제공하므로 새 에이전트로 원활하게 마이그레이션할 수 있습니다. 에이전트는 이미 데이터 필터링, 범위 지정 및 멀티 호밍과 같은 새로운 기능을 지원합니다. 또한 Azure Monitor 에이전트는 Log Analytics 에이전트에 필요한 레거시 작업 영역 키 대신 시스템 관리 ID를 사용합니다. 이를 통해 더 큰 규모의 에이전트 배포가 더 쉽고 안전해집니다.
- **더 나은 애플리케이션 모니터링을 위해 Application Insights 사용**: Application Insights는 사용자 동작, 애플리케이션 동작, 애플리케이션 성능 등에 대한 더 깊은 통찰력을 제공할 수 있습니다. 이렇게 하면 중요한 문제를 보다 신속하게 해결하는 데 도움이 됩니다. 또한 제품을 최적화하고 대응력을 향상시키기 위한 실행 가능한 통찰력을 제공합니다. 마지막으로, Application Insights를 사전에 사용하여 애플리케이션의 잠재적인 문제를 식별하고 해결할 수 있습니다.
- **Azure Monitor에 대한 프라이빗 연결을 위해 프라이빗 링크 사용**: 프라이빗 링크 서비스를 사용하면 Azure ExpressRoute를 사용하여 개인 네트워크를 통해 Azure Monitor에 연결할 수 있습니다. 결과적으로 모든 로깅 트래픽은 개인 네트워크를 통해서만 전송되고 액세스 가능합니다. 이는 공용 네트워크를 통한 로그 전송을 금지하는 규정 준수 요구 사항이 있는 환경에서 유리할 수 있습니다.
- **키를 사용하여 Log Analytics에서 사용하는 Azure Storage 계정을 암호화**: Microsoft 관리형 키를 사용하여 이 스토리지를 암호화하거나 Azure Key Vault와 통합된 자체 키를 사용하여 이 암호화를 달성할 수 있습니다. 사용자 환경에서 자체 고객 관리형 키를 사용해야 하는 규정 준수 이유가 있는 경우 Azure Monitor는 이를 지원하며, 필요한 경우 이 기능을 사용할 수 있습니다.
- **가능한 경우 자동 크기 조정을 사용**: Azure Monitor는 Azure VM 확장 집합, Azure API Management 서비스, Azure App Services 및 Azure Cloud Services와 같은 다양한 Azure 워크로드에 대한 자동 크기 조정을 트리거하는 모니터링 규칙 사용을 지원합니다. 따라서 애플리케이션 내에서 논리를 구축하여 사용자 로드에 따라 자동으로 확장 또는 축소할 수 있으므로 애플리케이션 응답 시간이 향상되고 비용이 최적화됩니다. 이는 응용 프로그램이 지원한다면 사용하기에 좋은 기능입니다.
- **새 Azure 리소스에 대한 모니터링을 자동으로 활성화**: Azure Monitor를 사용하면 환경에 추가된 새 리소스에 대한 모니터링을 자동으로 활성화하여 처음부터 적극적으로 관찰되도록 할 수 있습니다. DevOps 통합을 사용한 지속적인 모니터링도 지원되므로 새 애플리케이션 리소스가 자동으로 Azure Monitor 범위에 포함됩니다. 워크로드가 모니터링되는지 확인하기 위해 지속적으로 수동으로 개입할 필요 없이 환경 내 문제의 근본 원인을 쉽게 식별할 수 있도록 이러한 기능을 설정하는 것이 좋습니다.
- **실행 가능한 알림 설정**: 알림을 받는 것만으로는 충분하지 않은 경우가 있습니다. 경고를 트리거한 조건을 완화하려면 사전 정의된 작업 유형을 수행할 수 있는 경고가 필요합니다. 이를 실행 가능한 경고라고 합니다. 실행 가능한 경고의 예로는 리소스 사용률을 기반으로 한 워크로드 자동 크기 조정, 리소스 메트릭을 기반으로 Azure Automation Runbook 트리거, 미리 정의된 기준 또는 로그 이벤트를 기반으로 외부 리소스를 활성화하는 웹후크 트리거 등이 있습니다. 리소스의 관련 관리자에게 이메일 메시지, SMS 메시지 또는 음성 통화를 자동으로 보내는 것도 실행 가능한 경고로 분류됩니다. 그러나 가능하다면 가동 중지 시간을 최소화하기 위해 수동 개입 없이 문제를 완화하거나 해결하는 자동화된 작업을 구성하는 것이 좋습니다.
- **가능한 경우 동적 임계값(Thresholds) 사용**: 정적 임계값과 달리 동적 임계값을 사용하면 Azure Monitor는 관찰된 리소스 사용량을 기반으로 모니터링 기준선을 개발할 수 있습니다. 결과적으로 잘못된 긍정 경고의 수를 줄일 수 있습니다. 사용량이 일관되지 않고 일시적인 성능 변동으로 인해 오탐지가 발생할 수 있는 리소스에 대해 동적 임계값을 사용합니다.
- **팀 간 대시보드를 공유하여 일관된 모니터링 보장**: Azure Monitor를 사용하면 대시보드를 공유하여 여러 팀 구성원 또는 상호 의존적인 팀이 동일한 리소스 메트릭 및 이벤트를 모니터링할 수 있습니다. 이를 통해 문제가 발생할 때 적시에 대응할 수 있습니다. 모니터링하는 각 애플리케이션이나 서비스에 대한 올바른 핵심 성과 지표(KPI)를 식별하고 추적하려면 다양한 팀 구성원 및 상호 연결된 팀과 협력하여 이러한 대시보드를 개발하는 것이 좋습니다.
- **모니터링 임계값 및 KPI를 정기적으로 검토**: 특히 대규모 조직에서는 진행 중인 개발, 내부 피드백, 기록 성과 지표 및 기타 관련 기준을 기반으로 모니터링 설정 및 업데이트 임계값 및 KPI에 대한 정기적인 공동 검토를 수행하는 것이 좋습니다. 이렇게 하면 모니터링 솔루션을 최신 상태로 유지하고 관련 경고를 제공하는 데 도움이 됩니다.
