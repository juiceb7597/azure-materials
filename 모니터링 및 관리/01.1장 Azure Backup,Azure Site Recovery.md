#제 1장 Azure Backup

##개요
- Microsoft는 Azure Backup이라는 Azure에서 포괄적인 백업 서비스 솔루션을 제공합니다. Azure Backup을 사용하면 안전하면서도 비용 효율적인 방식으로 단기 및 장기 보존을 위해 온-프레미스, 클라우드 기반 및 Azure 기반 워크로드를 백업할 수 있습니다. Azure Backup은 수년에 걸쳐 발전하여 유용성, 안정성 및 중복성을 대폭 개선한 다양한 주요 기능을 추가했습니다. 결과적으로 Azure를 사용하거나 Azure로 마이그레이션하는 대부분의 조직을 위한 사실상의 백업 솔루션입니다.
- Azure Backup은 온-프레미스 환경 또는 Azure 환경에서 워크로드를 백업하는 데 사용할 수 있는 다양한 백업 에이전트 또는 솔루션을 제공합니다. 여기에는 다음이 포함됩니다.
    - **MARS(Microsoft Azure Recovery Services)**: 파일이나 폴더 수준 또는 시스템 상태 백업을 위해 Azure 또는 온프레미스 Windows VM(가상 머신)에 MARS 에이전트를 배포할 수 있습니다.
    - **Microsoft System Center Data Protection Manager(DPM)**: Microsoft DPM은 온프레미스 물리적 또는 가상 Hyper-V 또는 VMWare 기반 백업을 관리하기 위한 백업 솔루션으로 수년 동안 존재해 왔습니다. 클라우드 기반 데이터 전송 및 보존을 위해 Azure Backup과의 통합을 지원하고 해당 백업을 관리하기 위한 중앙 콘솔을 제공합니다. DPM에는 Azure Backup 서비스와 관련된 비용 외에 추가 라이선스가 필요합니다.
    - **MABS(Microsoft Azure Backup Server)**: MABS는 Azure Backup과 다시 개발되고 통합된 수정된 DPM 버전입니다. 이는 Azure Backup 서비스 비용에 포함됩니다. MABS는 단기 보존을 위해 백업의 로컬 복사본을 백업하고 유지 관리하기 위해 온-프레미스 백업 서버가 필요하고 장기 보존을 위해 Azure Storage가 사용되는 시나리오를 해결하는 데 도움이 됩니다. Microsoft Exchange, Microsoft SharePoint 등과 같은 추가 애플리케이션 워크로드의 백업을 지원합니다. 사용자 지정 백업 빈도 및 보존 요구 사항이 포함된 특정 백업 시나리오를 해결하기 위해 Azure VM을 백업하는 데에도 사용할 수 있습니다.
    - **Azure Backup 확장(extension)**: Azure Backup 확장은 개별 파일이나 폴더 또는 시스템 상태만 백업하는 대신 전체 Azure VM(Windows/Linux)을 백업하려는 시나리오에 도움이 됩니다.
- Azure IaaS, 온-프레미스 VM 및 물리적 온-프레미스 서버 외에도 Azure Backup은 다양한 Azure 서비스의 백업도 지원합니다
    - **Azure Managed Disks**: Azure Backup은 Azure Managed Disks를 백업 또는 Recovery Services 자격 증명 모음에 직접 백업하고 보존하는 것을 지원합니다.
    - **Azure 파일 공유**: Azure Backup은 Azure 파일과 통합되며 파일 공유 데이터의 단기 및 장기 보존을 위한 서비스의 일부로 백업을 구성할 수 있습니다.
    - **Azure VM에서 실행되는 SQL Server**: Azure Backup은 MARS 에이전트 또는 MABS 솔루션을 사용하여 SQL 데이터베이스 인식 백업을 지원하므로 일관된 방식으로 복원이 가능합니다.
    - **Azure VM에서 실행되는 SAP HANA 데이터베이스**: Azure Backup은 MARS 에이전트 또는 MABS 솔루션을 사용하여 SAP HANA 데이터베이스 인식 백업을 지원하므로 일관된 방식으로 복원이 가능합니다.

<img src="https://drive.google.com/uc?id=1zSDYziDSP3Zi-RA67Xh9UkvGDZUY01WD">



##주요 특징들
- **비용 효율적인 클라우드 기반 솔루션**: Azure Backup은 대부분의 소규모 및 대규모 조직의 요구 사항을 해결하는 매우 비용 효율적인 백업 솔루션을 제공합니다. 백업 스토리지에 대한 서비스 요금은 사용량을 기준으로 책정됩니다. 즉, 사용하기 전에 스토리지를 확보하거나 비용을 지불할 필요가 없습니다. 백업 범위에서 워크로드를 추가하거나 제거할 수 있습니다. 서비스 요금은 실제 사용량을 기준으로 매월 업데이트됩니다.
- **Azure과 통합된 서비스**:Azure Backup은 Azure에 통합되어 직관적이고 사용하기 쉽습니다. 추가 라이선스를 구입하거나 백업 관리를 위해 추가 서버를 배포하지 않고도 워크로드 백업을 빠르게 시작할 수 있습니다.
- **설계에 따른 확장성**: Azure Backup은 설계에 따라 확장 가능하며 하드웨어나 인프라를 미리 프로비저닝할 필요 없이 단일 VM 또는 수천 개의 VM 백업을 지원합니다.
- **고가용성 스토리지**: Azure Backup은 Azure Storage를 사용하여 백업을 저장합니다. 따라서 지역 간 데이터 중복성을 위해 LRS, GRS 및 ZRS 저장소와 같은 Azure Storage에서 사용할 수 있는 중복성 옵션을 사용합니다.
- **다양한 Azure 서비스 지원**: Azure Backup은 다양한 Azure 서비스에 대한 지원을 제공하며 더 많은 서비스를 지원하기 위해 지속적으로 업데이트됩니다. 현재 지원되는 서비스 목록에는 Azure VM, Azure 파일 공유, Azure Blob Storage 및 Azure 관리 디스크가 포함됩니다.
- **다양한 시나리오를 위한 다양한 백업 도구**: Azure Backup은 다양한 조직 및 시나리오의 요구 사항을 해결하기 위해 MARS 에이전트, Azure Backup 서버, DPM 및 Azure Backup 확장과 같은 다양한 백업 도구를 제공합니다.
- **단기 및 장기 보존 지원**: Azure Backup은 단기 및 장기 백업 보존을 모두 지원하며 다양한 워크로드에 다양한 백업 정책을 적용할 수 있습니다. 이러한 방식으로 각 고유 워크로드의 요구 사항에 따라 백업을 유지할 수 있습니다.
- **기본적으로 보안 유지**: Azure Backup은 TLS 암호화를 사용하여 백업 또는 Recovery Services 자격 증명 모음에 백업을 전송하므로 기본적으로 보안이 유지됩니다. 백업은 암호화된 Azure Storage에 저장됩니다. Azure Backup은 또한 BitLocker 및/또는 Azure Key Vault와 함께 Azure 관리 또는 고객 관리 암호화 키를 사용하여 암호화가 설정된 서버 백업을 지원합니다.
- **온라인 데이터 전송 비용 없음**: Azure Backup은 서비스와의 온라인 데이터 전송에 대해 비용을 청구하지 않습니다. 초기 백업 업로드를 위해 수행된 경우 오프라인 전송에 대해서만 일회성 비용이 청구됩니다.
- **중앙 집중식 모니터링 및 관리**: Azure Backup을 사용하면 Azure Portal의 중앙 콘솔에서 백업을 모니터링하고 관리할 수 있으므로 단일 위치에서 경고를 쉽게 설정할 수 있습니다. Azure Backup은 고급 보고 시나리오를 해결하기 위해 Azure Monitor와의 통합도 지원합니다.
- **다양한 관리 도구 지원**: Azure Backup은 Azure Portal, Azure PowerShell, Azure CLI(명령줄 인터페이스), ARM 템플릿 및 REST API를 사용한 관리를 지원합니다.
- 참고이 장의 나머지 부분에서는 주로 Azure Backup 서비스에서 가장 널리 사용되는 백업 옵션인 MARS 에이전트와 관련된 백업 시나리오에 중점을 둡니다.

##설계 및 배포 개념과 고려 사항
복구 서비스 자격 증명 모음(Vault)
- Recovery Services 자격 증명 모음(Vault)은 Azure IaaS VM, Azure 파일 공유, SQL 및 SAP HANA 데이터베이스 백업과 서비스에서 지원하는 기타 워크로드에 대한 백업 구성, 백업 작업 및 관련 백업 데이터를 관리하는 Azure의 중앙 스토리지 엔터티입니다. 또한 자격 증명 모음은 Azure Backup Server, DPM, Windows Server 등을 사용하여 구성된 백업을 모니터링하고 관리하는 중앙 위치 역할도 합니다.
- Vault의 주요 기능은 다음과 같습니다.
    - **중앙 집중식 관리 및 모니터링**: Recovery Services 자격 증명 모음은 MARS 에이전트를 사용하여 구성된 백업을 설정, 관리 및 모니터링할 수 있는 단일 중앙 관리 콘솔을 제공합니다. 이를 통해 쉽게 백업 상태를 감시하고 백업 또는 복원 실패 시 경고를 설정할 수 있습니다.
    - **백업된 데이터의 보안 강화**: Recovery Services 자격 증명 모음을 사용하면 무단 구성 변경 및 데이터 삭제를 방지하는 보안 PIN을 설정할 수 있습니다. 누군가가 서비스에서 이러한 작업을 시도할 때마다 저장소는 PIN 요구 사항을 시행합니다. 잘못된 PIN을 입력하면 작업이 거부됩니다. 온-프레미스 백업의 경우 자격 증명 모음은 백업 생성 시 설정되고 Azure에 저장될 때 데이터를 암호화하는 데 사용되는 16자 암호를 적용합니다.
    - **Azure AD를 사용하는 RBAC**: Recovery Services 자격 증명 모음은 Azure AD를 활용하여 역할 또는 운영 요구 사항에 따라 권한이 부여된 관리자에게만 서비스에 대한 액세스를 제어하고 제한하는 RBAC를 지원합니다.
    - **데이터 복원력 및 복구**: Vault는 LRS, ZRS 및 GRS Azure Storage 계정과의 통합을 지원하여 Azure 지역 내 영역 또는 Azure 지역 전체에 데이터 복원력을 제공합니다. 또한 자격 증명 모음은 쌍을 이루는 Azure 지역 전체에서 데이터 복원을 지원하므로 데이터를 보조 지역에서 온라인으로 가져와야 하거나 감사 또는 규정 준수 검사를 준수해야 하는 시나리오에서 도움이 됩니다.
    - **악의적 공격으로부터 보호**: 볼트는 보존 정책에 따라 공격 날짜 이전에 깨끗한 데이터를 복원할 수 있도록 하여 악의적 공격으로부터 보호합니다. 데이터 일시 삭제 보존을 활성화한 경우 볼트는 볼트 데이터의 악의적 삭제를 삭제 후 14일 동안 복구할 수 있도록 보장합니다.
    - **설계에 따른 확장성**: Azure는 현재 MARS 에이전트를 사용하여 1,000개의 VM, 2,000개의 백업 데이터 원본 또는 항목, Recovery Services 자격 증명 모음당 200개의 백업 정책을 지원합니다. 현재 각 구독은 500개의 Recovery Services 자격 증명 모음을 지원하므로 대부분의 대규모 조직의 백업 요구 사항을 해결할 수 있는 확장성이 뛰어난 서비스입니다.

백업센터
- 백업 센터는 기업이 대규모 백업을 관리, 모니터링, 운영 및 분석할 수 있는 통합 관리 환경을 제공합니다. 따라서 이는 Azure의 기본 관리 환경과 일치합니다. 백업 센터는 다음을 제공합니다.
    - **백업을 관리하는 단일 창**: 백업 센터는 대규모 분산 Azure 환경에서 원활하게 작동하도록 설계되었습니다. 백업 센터를 사용하면 여러 워크로드 유형, 자격 증명 모음, 구독, 지역 및 Azure Lighthouse 테넌트에 걸친 백업을 효율적으로 관리할 수 있습니다.
    - **데이터 소스 중심 관리**: 백업 센터는 백업 중인 데이터 소스(예: VM 및 데이터베이스)를 중심으로 보기 및 필터를 제공합니다. 이를 통해 리소스 소유자 또는 백업 관리자는 항목이 백업되는 저장소에 초점을 맞추지 않고도 항목 백업을 모니터링하고 운영할 수 있습니다. 이 디자인의 주요 기능은 데이터 원본 구독, 데이터 원본 리소스 그룹 및 데이터 원본 태그와 같은 데이터 원본별 속성을 기준으로 보기를 필터링하는 기능입니다. 예를 들어 조직에서 서로 다른 부서에 속한 VM에 서로 다른 태그를 할당하는 경우 백업 센터를 사용하면 자격 증명 모음의 태그에 집중할 필요 없이 백업되는 기본 VM의 태그를 기반으로 백업 정보를 필터링할 수 있습니다.
    - **연결된 경험(Connected Experiences)**: Backup Center는 대규모 관리를 지원하는 기존 Azure 서비스에 대한 기본 통합을 제공합니다. 예를 들어 백업 센터는 Azure Policy를 사용하여 백업을 관리하는 데 도움을 줍니다. 또한 Azure 통합 문서 및 Azure Monitor 로그를 활용하여 백업에 대한 자세한 보고서를 제공합니다. 따라서 백업 센터가 제공하는 다양한 기능을 사용하기 위해 새로운 원칙을 배울 필요가 없습니다. 백업 센터에서 커뮤니티 리소스를 검색할 수도 있습니다.

데이터 플레인
- Azure Backup은 데이터 평면과 관리 평면이라는 두 가지 주요 구성 요소로 분류됩니다. 각 플레인은 특정 기능을 제공하고 다른 플레인을 보완하여 서비스가 의도한 대로 작동하도록 합니다. 데이터 플레인에서 수행되는 기능은 다음과 같습니다.
    - **데이터 보호**: 데이터 플레인은 볼트 구성에 설정된 데이터 보호 정책이 준수되도록 보장합니다. 실수로 또는 악의적으로 삭제된 모든 데이터를 14일 동안 복구할 수 있도록 보장합니다. 이는 구성을 활성화하는 한 모든 고객에게 추가 비용 없이 제공됩니다.
    - **유휴 데이터 암호화**: 데이터 플레인은 서비스에 설정된 암호화 구성에 따라 모든 유휴 백업 데이터가 암호화되도록 보장합니다. 데이터 복원 작업 시 필요에 따라 데이터 암호 해독을 수행합니다.
    - **데이터 수명 주기 관리**: 데이터 플레인은 백업 데이터의 전체 수명 주기를 관리하여 저장소 구성에 설정된 보존 정책을 준수하는지 확인합니다.
    - **스토리지 관리 자동화**: 데이터 플레인은 백업 데이터에 사용되는 스토리지 계정의 자동 프로비저닝, 크기 조정 및 확장을 관리합니다.

관리(Management) 플레인
- 관리 플레인은 볼트의 전반적인 관리 및 액세스 보안을 지원하는 추가 보완 기능 세트를 수행합니다. 여기에는 다음이 포함됩니다.
    - **백업 정책 관리**: 관리 플레인는 백업 및 보존 정책을 중앙에서 구성하고 관리하는 기능을 제공합니다.
    - **RBAC 제어 시행**: 관리 플레인는 역할 요구 사항에 따라 자격 증명 모음에 대한 액세스를 제어하고 권한 있는 관리자로 제한하기 위해 RBAC 권한을 구성하는 기능을 제공합니다. 모든 액세스 요청을 모니터링, 승인 및 기록하므로 무단 요청을 더 쉽게 추적할 수 있습니다.
    - **관리 도구 지원**: 관리 플레인은 Azure Portal, Azure PowerShell, Azure CLI, REST API 및 백업 센터를 사용하여 Recovery Services 자격 증명 모음을 관리하는 기능을 제공합니다.
    - **보고 및 관리**: 모든 보고, 경고 및 관리 기능은 관리 플레인 내에서 제공되는 기능 덕분에 구성 가능합니다. 여러 자격 증명 모음에 대한 중앙 집중식 백업 모니터링을 위해 Log Analytics와의 통합을 지원합니다.
    - **스냅샷을 사용하여 더 빠르게 복원**: 관리 플레인 Azure VM 및 Azure 파일에 대한 스냅샷 백업을 처리하므로 스토리지 자격 증명 모음보다 더 빠른 데이터 복원이 가능합니다. 이는 데이터 복원 작업 중에 사용자 환경의 RTO를 줄이는 데 도움이 될 수 있습니다.

백업 에이전트
- Azure Backup 서비스 구성 요소는 두 가지 주요 유형의 백업 에이전트를 제공합니다.
    - **MARS 에이전트**: Azure IaaS VM 및 온-프레미스 Windows Server의 시스템 상태, 파일 수준 및 폴더 수준 백업을 지원합니다. DPM 및 MABS 서버와 통합되어 장기 보존을 위해 해당 구성 요소의 로컬 디스크 백업을 Azure에 저장합니다.
    - **Azure VM 확장(Extension)**: 전체 VM 수준 백업을 수행하기 위해 Azure IaaS VM에만 설치됩니다.

지원되는 백업 유형
- **전체(Full) 백업**: 전체 VM, 데이터베이스 또는 파일/폴더 구조를 포함하는 대상 데이터 소스의 백업입니다. 증분, 차등 또는 트랜잭션 로그 백업을 수행하기 전에 필요한 데이터 원본의 전체 복사본을 Azure Backup에 제공하려면 항상 전체 백업으로 새 백업을 시작해야 합니다. Azure Backup은 현재 하루에 한 번의 전체 백업만 허용합니다.
- **차등(Differential) 백업**: 차등 백업에는 마지막 전체 백업의 데이터가 포함됩니다. 이러한 유형의 백업은 Azure VM에서 실행되는 SQL 및 SAP HANA 데이터베이스에 지원됩니다. 차등 백업은 해당 날짜에 발생한 데이터 변경 사항에 관계없이 마지막 전체 백업 이후 수정된 데이터를 반복적으로 백업하므로 가장 효율적이지 않습니다. 이 백업 유형을 주의 깊게 사용하는 것이 중요합니다. 데이터베이스 백업과 같은 특정 시나리오에서 복원 속도를 높이는 데 도움이 될 수 있지만 백업 스토리지를 추가로 사용할 수도 있습니다. Azure Backup은 하루에 한 번만 차등 백업을 허용하며 전체 백업과 같은 날에는 허용하지 않습니다.
- **증분(Incremental) 백업**: 이 백업에는 마지막 전체 또는 증분 백업의 데이터가 포함됩니다. 증분 백업은 Azure VM에서 실행되는 SAP HANA 데이터베이스에서 지원됩니다. 마지막 백업 이후의 변경 사항만 백업하므로 차등 백업보다 더 효율적입니다. 이렇게 하면 변경되지 않은 블록의 중복 백업이 줄어듭니다. 증분 백업은 차등 백업과 함께 예약할 수 없습니다. 둘 중 하나만 정기적으로 실행되도록 설정할 수 있습니다. 증분 백업은 하루에 한 번만 수행할 수 있으며 전체 백업과 같은 날에는 수행할 수 없습니다.
- **트랜잭션 로그 백업**: 이러한 백업은 Azure VM에서 실행되는 SQL 및 SAP HANA 데이터베이스 모두에서 지원됩니다. 이는 대상 VM에서 실행되는 데이터베이스의 증분 로그 백업입니다. 최대 15분마다 한 번씩 실행되도록 예약할 수 있습니다. 포괄적인 데이터베이스 백업 전략을 위해 전체 및 증분 백업과 함께 트랜잭션 로그 백업을 사용할 수 있습니다.

백업 정책
- 백업 정책은 백업 일정 및 보존 구성을 정의합니다. 각 워크로드의 일정 및 보존 요구 사항에 따라 다양한 워크로드에 다양한 백업 정책을 적용할 수 있습니다. 예를 들어 오후 9시에 중요한  애플리케이션 서버를 백업하는 백업 정책을 생성할 수 있습니다. 매일, 365일 보존됩니다. 이와 반대로 매주 일요일 오후 9시에 중요하지 않은  애플리케이션 서버를 백업하고 4주 동안 보존하는 백업 정책을 생성할 수 있습니다.
- 자격 증명 모음(Vault)당 최대 200개의 정책과 정책당 대상 항목 100개를 보유할 수 있습니다. 여러 애플리케이션이나 서버의 보존 및 예약 요구 사항이 동일한 경우 구독 제한에 도달하지 않도록 동일한 백업 정책을 사용하는 것이 가장 좋습니다. 해당 정책에 대한 항목 제한인 100개에 도달하면 나머지 항목에 대해 중복 정책을 생성하십시오.

백업 예약
- 백업을 예약할 때 백업이 발생해야 하는 시간과 빈도를 정의해야 합니다. 이는 매일, 매주, 매월, 매년 또는 일정의 조합일 수 있습니다.
    - 일일 백업은 매일 지정된 시간에 발생합니다.
    - 주간 백업을 수행하려면 백업을 수행할 요일과 시간을 선택해야 합니다.
    - 월별 백업을 수행하려면 백업이 수행되어야 하는 날짜와 시간을 정의해야 합니다.
    - 연간 백업을 수행하려면 백업이 수행되어야 하는 날짜와 시간을 정의해야 합니다.
- 영향을 제한하려면 사용량이 적은 시간에 프로덕션 백업을 예약하는 것이 좋습니다. 또한 동시에 발생하는 백업 작업이 너무 많지 않도록 백업 창 전체에 걸쳐 백업 작업을 시차를 두십시오. 그렇지 않으면 백업 작업으로 인해 전체 환경이 느려지고 백업 시간도 길어질 수 있습니다.

백업 보존
- 백업 보존은 Recovery Services 자격 증명 모음에 백업을 저장해야 하는 기간을 정의합니다. 일수로 제한된 보존 기간은 단기 보존 기간을 정의합니다. 몇 주, 몇 달 또는 몇 년으로 제한된 보존 기간은 장기 보존 기간을 정의합니다. 해당 애플리케이션의 감사, 규정 준수 및 복구 요구 사항을 기반으로 각 애플리케이션에 대한 보존을 설정해야 합니다.
- 필요에 따라 백업을 실행할 수도 있습니다. 예를 들어, 업그레이드 활동 전에 필요한 경우 해당 시점으로 롤백할 수 있도록 백업을 생성하기로 결정할 수 있습니다. 주문형 백업은 해당 워크로드에 구성되거나 적용되는 보존 정책을 준수하지 않습니다.

백업 압축
- Azure Backup은 Recovery Services 자격 증명 모음으로 전송되기 전에 원본에서 온-프레미스 백업 데이터의 압축을 지원합니다. 이 압축은 온-프레미스 서버 또는 Azure Backup Server 솔루션의 파일 또는 폴더 백업을 위해 설정된 MARS 에이전트의 기능입니다. 백업 확장을 사용하는 Azure VM 백업은 압축을 지원하지 않습니다.

백업 모니터링
- Azure Backup에는 모든 백업 에이전트, 예약된 백업 작업, 작업 결과, 복원 작업 및 기타 관련 관리 활동을 추적하는 기본 제공 모니터링 엔진이 있습니다. 이 기본 제공 엔진을 사용하여 각 Recovery Services 자격 증명 모음을 모니터링할 수 있습니다. 그러나 여러 저장소에서 이 정보를 모니터링하려면 다음과 같은 다른 옵션을 사용하는 것이 좋습니다.
    - **백업 탐색기(Explorer)**: 백업 탐색기는 Microsoft에서 Azure Monitor 서비스의 일부로 제공하는 미리 정의된 통합 문서입니다. 관리자가 액세스할 수 있는 모든 백업 볼트의 작업 기록을 포함하여 모든 백업 및 복원 작업에 대한 단일 보기를 제공합니다. 현재 백업용으로 설정되지 않은 작업 부하를 신속하게 식별하는 데 도움이 될 수 있습니다.
    - **Log Analytics가 포함된 Azure Monitor**: Log Analytics 작업 영역에 모든 로그를 저장하도록 Azure Backup을 구성할 수 있습니다. Azure Monitor는 여러 자격 증명 모음에서 작업 모니터링을 위한 시각화 및 경고를 만들 수 있습니다.

경고 (Alert)
- Azure Backup은 식별된 트리거를 기반으로 정의된 사용자 또는 배포 그룹에 이메일 기반 경고를 보내는 기본 제공 경고 엔진을 제공합니다. 트리거의 예로는 백업 실패, 복원 실패, 백업 데이터 또는 보호 삭제 등이 있습니다. 기본 제공 엔진은 표준 경고 시나리오에 대한 경고를 설정하는 데 충분한 기능을 제공합니다. 그러나 기본 제공 엔진에서 다루지 않는 시나리오를 해결하기 위해 사용자 지정 경고가 필요한 경우 Azure Monitor를 사용하면 로그 수집을 위해 Log Analytics를 사용하여 경고를 설정할 수 있습니다.

보안
- Azure Backup은 전송 중 및 저장 중 백업 데이터 보안부터 시작하여 서비스 액세스 제어까지 확장하여 여러 수준에서 보호됩니다.
- 전송 중인 데이터와 관련하여 Azure는 MARS 에이전트에서 Azure Backup 및 스토리지로 전송되는 모든 데이터가 HTTPS를 통해 발생하는지 확인합니다. 또한 Azure Backup과 스토리지 간의 모든 데이터 전송에는 HTTPS가 사용되므로 전송 중 데이터 보안이 보장됩니다.
- Azure는 플랫폼 관리 키 또는 Azure Key Vault 서비스에 저장된 고객 관리 키를 사용하여 Azure 스토리지에 저장된 모든 데이터(즉, 미사용 데이터)를 암호화합니다. 이는 백엔드에서 도난당하더라도 데이터를 읽을 수 없도록 하는 데 도움이 됩니다. Azure Backup은 Azure Key Vault 통합과 함께 BitLocker 암호화를 사용하여 Azure 데이터 암호화 디스크의 백업도 지원합니다.
- Azure Backup 서비스는 Recovery Services 자격 증명 모음의 세부적인 액세스 제어를 위해 Azure RBAC(역할 기반 액세스 제어)를 사용합니다. RBAC에서 제공되는 사전 정의된 보안 역할을 사용하여 역할 및 의무에 따라 관리자에게 액세스 권한을 할당할 수 있습니다. 이러한 역할에는 다음이 포함됩니다.
    - **백업 기여자**: 구성원은 볼트를 생성하고 삭제할 수 있습니다. 새로운 백업을 활성화합니다. 백업 정책 생성, 삭제 및 관리 백업 보호를 중지하고 삭제합니다. 모든 운영자 활동을 수행합니다.
    - **운영자(Operators)**: 구성원은 백업 및 복원 작업을 트리거할 수 있습니다.
    - **Readers**: Members는 백업 구성을 읽을 수만 있습니다.
- 환경별 권한이 포함된 사용자 지정 역할을 생성하고 이를 관리자에게 할당하여 세부적인 제어를 수행할 수도 있습니다. 백업 서비스 자체 외에도 모든 백업 데이터를 보유하는 백엔드 스토리지 계정은 또 다른 관심사입니다. Azure는 Azure Backup 서비스 외에 다른 사용자 또는 서비스가 백업 또는 복원과 같은 작업 중에 이러한 스토리지 계정에 액세스할 수 없도록 보장합니다.

##모범 사례
- **올바른 Azure Backup 스토리지 복제 유형 설정**: Azure Backup은 LRS, ZRS 또는 GRS 복제 유형을 사용하는 스토리지를 지원합니다. 각각은 점진적으로 더 높은 수준의 중복성을 제공하지만 발생하는 비용도 증가합니다. 기본적으로 서비스는 백업용 GRS 스토리지를 생성합니다. 그러나 해당 수준의 중복성이 필요하지 않거나 저장소에서 발생하는 비용을 제어하려는 경우 백업을 생성하기 전에 이 복제 유형을 변경하십시오. 백업이 시작되면 이 구성을 변경할 수 없습니다.
- **백업을 위한 인터넷 연결 제한**: VM용 Azure Backup은 Azure 네트워크를 통해 직접 수행되므로 인터넷 URL에 대한 액세스를 열 필요가 없습니다. 그러나 Azure VM에서 실행되는 SQL 및 SAP HANA 데이터베이스는 인터넷이나 Azure Backup에 대한 Private Link를 사용하여 연결해야 합니다. Azure Private Link가 실행 가능한 옵션이 아닌 경우 백업을 위한 인터넷 액세스가 Azure Backup에 필요한 네트워크 URL로 제한되는지 확인하세요. Azure는 이러한 URL 목록을 공개적으로 게시하고 변경 사항이 발생하면 주기적으로 업데이트합니다.
- **SQL 및 SAP HANA 백업에 프라이빗 엔드포인트 및 프라이빗 링크 사용**: Azure VM에서 실행되는 SQL 및 SAP HANA 데이터베이스는 인터넷을 통해 백업할 수 있지만 이를 보장하려면 Private Link를 사용하여 연결할 Azure Backup용 프라이빗 엔드포인트를 설정하는 것이 가장 좋습니다. 백업은 비공개 내부 연결을 통해 이루어집니다. 이렇게 하면 중간자 공격의 가능성을 방지할 수 있습니다.
- **더 나은 관리를 위해 백업 센터 사용**: 백업 센터는 모든 Recovery Services 자격 증명 모음에 분산된 모든 백업을 중앙에서 관리하는 무료 Azure 서비스입니다. 이 서비스를 사용하면 사용자 환경에서 발생하는 모든 백업을 한 눈에 볼 수 있습니다.
- **자동 백업 예약을 위해 Azure Policy 사용**: 수백 또는 수천 개의 VM이 있는 대규모 조직에서는 조직의 요구 사항에 따라 백업을 위해 모든 새 VM을 추적하고 설정하는 것이 어려운 작업일 수 있습니다. Azure Policy를 사용하여 특정 구독, 지역 또는 리소스 그룹에 설정된 새 VM에 대한 백업 정책을 정의하고 적용합니다. 이를 통해 자동으로 할당되어야 하는 볼트 및 백업 정책을 정의할 수 있습니다.
- **중앙 집중식 모니터링 및 보고를 위해 Log Analytics 사용**: 모든 Recovery Services 자격 증명 모음을 Log Analytics 서비스와 통합하면 모든 백업을 포함하여 각 자격 증명 모음에 대한 모든 메트릭이 세부 보고서 생성 및 장기 추적을 위해 자동으로 캡처됩니다.
- **자동화된 진단 로깅을 위해 Azure Policy 사용**: Azure Policy를 사용하여 Log Analytics 구성을 자동으로 설정하는 정책으로 모든 Recovery Services 자격 증명 모음을 구성할 수 있습니다. 이렇게 하면 새 보관소에 대해 이 작업을 수동으로 수행하는 데 따른 관리 오버헤드가 제거됩니다.
- **보관 계층을 사용하여 비용 절감**: Azure Backup은 Azure VM 및 Azure VM에서 실행되는 SQL 서버의 장기 보존 백업을 위해 보관 스토리지 계층 사용을 지원합니다. 이를 통해 6개월 이상 보존해야 하는 경우 월별 및 연간 백업 데이터를 아카이브 계층으로 푸시할 수 있습니다. 이를 통해 백업 스토리지 비용을 크게 절감할 수 있습니다.
- **악의적인 공격으로부터 보호하기 위해 보안 기본값을 설정**: 보안 기본값은 PIN 및 일시 삭제 보존 정책을 정의하여 서비스에 대한 무단 변경과 악의적이거나 우발적인 삭제 작업을 방지하거나 쉽게 되돌릴 수 있도록 합니다. 새 볼트를 생성하는 즉시 두 가지를 모두 설정해야 합니다.

#제 2장 Azure 사이트 복구(Site Recovery)

##개요
- **BCDR을 설정, 모니터링, 관리하기 위한 단순화된 인터페이스**: ASR은 서비스를 쉽게 설정, 모니터링 및 관리할 수 있는 직관적인 인터페이스를 제공합니다.
- **가장 일반적으로 사용되는 운영 체제 지원**: ASR은 대부분의 운영 체제 복제를 지원하며 지원 목록은 정기적으로 확장됩니다. 이를 통해 대부분의 조직에서 ACR을 원스톱 BCDR 솔루션으로 사용할 수 있습니다.
- **대부분의 조직의 RTO 및 RPO 목표를 충족하도록 복제 일정을 정의**: ASR은 Hyper-V VM의 경우 30초의 짧은 복제와 Azure VM의 경우 연속 복제를 지원합니다. VMware 지원은 현재 미리 보기 상태이지만 지속적인 복제가 허용될 것으로 예상됩니다.
- **모든 워크로드 지원**: ASR은 지원되는 운영 체제에서 호스팅되는 한 모든 워크로드의 복제를 지원합니다. 따라서 대부분의 조직의 요구 사항을 해결하는 실행 가능한 솔루션이 됩니다.
- **여러 DR 사이트에서 온프레미스 Hyper-V-Hyper-V 복제, 모니터링 및 복구 오케스트레이션**: ASR은 상호 연결된 여러 사이트에서 온프레미스 Hyper-V-Hyper-V 서버에 대한 복제 모니터링 및 장애 조치 조정을 지원합니다. Hyper-V 복제는 데이터 복제에 사용되지만 ASR은 클라우드에서 모든 복구 단계를 자동화하는 데 도움이 됩니다.
- **Azure 지역 전체에서 Azure 간 IaaS VM 복제, 모니터링 및 복구 오케스트레이션**: ASR은 2017년에 Azure 지역 전체에서 Azure VM 복제 및 장애 조치에 대한 지원을 추가했습니다. 이를 통해 조직은 여러 Azure 지역에서 중요한 클라우드 워크로드에 대한 BCDR 전략을 설정할 수 있었습니다.
- **온-프레미스 Hyper-V 및 물리적 서버에서 Azure로의 복제, 모니터링 및 복구 오케스트레이션**: ASR은 온-프레미스 Hyper-V 및 물리적 서버에서 Azure VM으로 호스팅되는 워크로드에 대한 전체 복구 관리를 지원합니다. Azure Storage는 복제된 데이터를 호스팅합니다. 장애 조치(failover)가 시작된 후에만 VM이 생성되므로 보조 데이터 센터와 관련된 비용이 절감됩니다.
- **애플리케이션을 보다 효율적으로 복구하기 위한 앱 일치 스냅샷**: ASR은 디스크 데이터, 메모리의 모든 데이터 및 프로세스 중인 모든 트랜잭션을 사용하여 애플리케이션이 복제되도록 보장하기 위해 복제용 앱 일치 스냅샷 사용을 지원합니다.
- **단순화되고 비용 효율적인 가격**: ASR은 복제 소프트웨어에 대해 서버당 고정 요금을 부과합니다. 복제된 데이터에 대한 Azure Storage 비용은 Azure에서 VM이 장애 조치된 후에만 청구됩니다. 대부분의 비용이 VM 실행과 관련되어 있으므로 Azure의 DR 사이트가 VM을 호스팅하는 데 적극적으로 사용되지 않을 때 매우 비용 효율적입니다. 이 모든 것을 통해 대부분의 조직은 자신의 환경에 맞는 BCDR 솔루션을 구입할 수 있습니다.
- **프로덕션 ASR을 중단하지 않고 DR을 테스트**: ASR은 Azure의 격리된 네트워크에서 복제된 데이터의 활성화를 지원합니다. 이를 통해 VM을 테스트하여 애플리케이션, 데이터베이스 및 기타 워크로드가 DR 시나리오에서 실제로 사용하기 전에 필요에 따라 작동하는지 확인할 수 있습니다. 이를 통해 애플리케이션 업그레이드를 온-프레미스 환경에서 구현하기 전에 Azure 클라우드에서 테스트할 수 있는 시나리오도 가능해집니다.
- **SQL Server AlwaysOn과의 통합 **: ASR은 SQL Server AlwaysOn과의 통합을 지원하여 상호 연결된 애플리케이션과 데이터베이스 워크로드를 모두 원활하게 복구할 수 있습니다.
- **Azure Automation과 통합**: Azure Automation을 사용하면 다른 Azure 서비스를 프로비저닝하기 위한 스크립트 및 자동화된 작업을 설정하거나 자동화된 복구 절차의 일부로 사전 및 사후 장애 조치(failover) 스크립트를 실행할 수 있습니다.
- **복제 그룹(Replication groups)을 사용한 다중 VM 일관성**: ASR은 여러 VM이 함께 복제되고 앱 일관성 및 충돌 일관성 복구 지점이 생성되어 장애 조치를 용이하게 할 수 있도록 다중 VM 복제 그룹 설정을 지원합니다. 이를 통해 여러 VM을 동일한 일관성으로 유지해야 하는 시나리오를 해결할 수 있습니다.

##Azure 간 재해 복구
- ASR을 사용하면 Azure IaaS VM을 다른 Azure 지역으로 복제하도록 설정할 수 있습니다. 복제를 활성화하면 ASR은 VM을 ASR 서비스에 등록하는 데 사용되는 Azure VM에 Site Recovery 에이전트 확장을 설치합니다. 이 작업이 완료되면 기존 디스크 데이터와 디스크 변경 사항이 선택 사항에 따라 대상 스토리지 계정 또는 관리 디스크로 전송됩니다. 선택한 Azure 지역에 관계없이 공용 인터넷이 아닌 Microsoft의 개인 네트워크를 사용하여 데이터가 전송되므로 데이터가 안전한 방식으로 전송됩니다. 복제는 지속적이고 충돌 일관성이 있으며 앱 일치 복구 지점은 VM에 대해 설정한 복제 정책을 기반으로 생성됩니다.

복제 정책(Replication policy)
- DR 설정 프로세스 중에 기본적으로 생성되고 연결된 복제 정책은 다음을 정의합니다.
    - **복구 지점 보존(Recovery-point retention)**: 이는 ASR이 복구를 허용하는 기간을 정의합니다. 서비스는 귀하가 정의한 보존 일정에 따라 복구 지점을 보존합니다. 현재 지원되는 최대 복구 지점 보존 기간은 관리 디스크의 경우 15일, 비관리 디스크의 경우 3일입니다. 기본값은 24시간입니다.
    - 복구 지점 보존 기간이 길수록 해당 VM에 대해 더 많은 데이터가 보존되므로 서비스에서 사용하는 스토리지에 대해 더 많은 비용이 청구됩니다.
    - **충돌 일관성 복구 지점(Crash-consistent recovery points)**: 은 VM 디스크 상태에 대한 스냅샷을 생성하여 대상 지역으로 전송합니다. 이러한 복구 지점은 메모리의 데이터를 캡처하지 않으므로 복구 시  애플리케이션이 일관성 없는 상태로 온라인 상태가 될 수 있습니다. 요즘 대부분의 애플리케이션은 충돌 일치 복구 지점을 지원하지만 가능하면 복구를 위해 앱 일치 복구 지점을 사용하는 것이 가장 좋습니다. 기본적으로 이는 5분마다 생성됩니다.
    - **앱 일치 복구 지점(App-consistent recovery points)**: 이는 메모리에서 실행되는 모든 프로세스, 데이터 및 트랜잭션과 함께 디스크에 있는 데이터의 스냅샷입니다. 이는 Windows 서버의 볼륨 섀도 복사본 서비스를 사용하여 캡처됩니다. 앱 일치 스냅샷은 충돌 일치 스냅샷보다 시간이 더 오래 걸리며 정의된 사용 가능한 리소스 및 빈도에 따라 서버에 로드를 추가할 수 있습니다. 이러한 스냅샷으로 인해 상당한 오버헤드가 발생하지 않는지 테스트하거나 추가 로드를 수용할 수 있도록 VM 워크로드 크기를 조정해야 합니다. 이 스냅샷에 지원되는 최소 빈도는 1시간입니다. 기본 설정은 4시간입니다.

데이터 보안
- ASR은 원본 지역과 대상 지역 간에 전송되는 데이터를 가로채거나 스캔하거나 분석하지 않습니다. 이는 전체 프로세스를 서비스에 투명하게 만들고 복제된 데이터가 악의적인 목적으로 사용될 위험을 제거합니다. 데이터는 전송 중에 암호화될 뿐만 아니라 대상 지역에 저장될 때 저장 중에도 암호화됩니다.

다중 VM 일관성
- 복제 설정 중에 여러 상호 종속 VM을 복제 그룹에 설정할 수 있으므로 공유된 충돌 일관성 및 앱 일관성 복구 지점을 사용하여 대상 지역에 복제됩니다. 이는 여러 애플리케이션, 인터페이스 및 데이터베이스 서버가 지원되는 장애 조치를 보장하기 위해 각각에 걸쳐 해당 수준의 데이터 일관성을 요구하는 경우 필요할 수 있습니다. 복제 그룹의 모든 VM은 동시에 장애 조치되어야 하며 개별적으로 장애 조치할 수 없습니다.
- 복제 그룹에는 최대 16개의 VM이 포함될 수 있습니다. VM은 복제를 위해 설정되는 경우에만 복제 그룹에 추가할 수 있습니다. 이미 복제 그룹에 복제 중인 VM을 추가하려면 해당 VM에 대한 복제를 다시 생성해야 합니다. 다중 VM 일관성은 상당히 리소스 집약적입니다. 따라서 VM이 이러한 공유 스냅샷을 보유하는 것이 중요한 시나리오에서만 활성화하는 것이 좋습니다.
- 다중 VM 일관성 복제 그룹의 일부인 모든 VM은 포트 20004를 통해 서로 통신해야 합니다. VM 간에 설정된 방화벽 또는 네트워크 보안 그룹이 이 트래픽을 허용하도록 구성되어 있는지 확인하십시오.

대상 환경 구성 (Target environment configuration)
- 복제를 설정한 후에도 대상 환경에 대해 다양한 구성 항목을 정의할 수 있습니다. 그러나 초기 설정 중에만 정의할 수 있는 몇 가지 구성 항목이 있습니다. 다음은 현재 지원되는 주요 항목 중 일부에 대한 간략한 목록입니다.
    - **대상(Target) VM SKU**: 복제 설정 중에 이를 정의하거나, 자동으로 설정된 상태로 두거나, 복제 설정 후에 수정할 수 있습니다. 자동으로 설정하면 ASR은 대상 지역의 리소스 가용성에 따라 동일하거나 유사한 VM SKU를 선택합니다.
    - **대상 리소스 그룹**: 복제 설정 중에 대상 리소스 그룹을 정의하거나 자동으로 설정된 상태로 둘 수 있습니다. 이 경우 서비스는 복제 설정 후 새 리소스 그룹을 생성하거나 기존 리소스 그룹을 수정합니다.
    - **대상 가상 네트워크**: 복제 설정 중에 대상 가상 네트워크를 정의하거나 자동으로 설정된 상태로 둘 수 있습니다. 이 경우 서비스는 복제 설정 후 새 네트워크를 생성하거나 기존 네트워크를 수정합니다.
    - **대상 서브넷**: 서비스는 소스 VM 서브넷 설정에 따라 VM을 서브넷에 자동으로 할당합니다. 복제 설정 후 대상 서브넷을 수정할 수 있습니다.
    - **대상 이름**: 서비스는 소스 VM 이름을 기반으로 대상 이름을 자동으로 할당합니다. 복제 설정 후 대상 이름을 수정할 수 있습니다.
    - **대상 디스크 유형**: 복제 설정 중에 대상 디스크 유형을 정의할 수 있습니다. 서비스는 소스 디스크 설정에 따라 디스크 유형을 자동으로 선택하지만 복제 설정 중에 필요한 경우 변경할 수 있습니다.
    - **대상 구독**: 서비스는 원본 VM 구독을 기반으로 구독을 자동으로 선택하지만 동일한 Azure AD 테넌트와 연결된 다른 구독이 있는 경우 복제 설정 중에 대신 선택할 수 있습니다.
    - **대상 근접(proximity) 그룹**: 서비스는 자동으로 대상 근접 그룹을 없음으로 설정하지만 복제 설정 중에 이를 변경할 수 있습니다.
    - **대상 VM 가용성 구성**" 서비스는 소스 VM을 기반으로 대상 VM 가용성 구성을 자동으로 설정하지만 복제 설정 시 이를 변경할 수 있습니다.

장애 조치 및 장애 복구 (Failover and failback)
- 주 지역에 재해가 발생한 경우 ASR 서비스를 사용하여 Azure VM을 대상 지역으로 장애 조치(failover)할 수 있습니다. 복원에 사용할 복구 지점을 선택하라는 메시지가 표시됩니다. 그러면 정의한 설정과 복제된 데이터를 기반으로 대상 VM이 생성됩니다.
- 대상 VM이 보호되지 않은 상태로 생성됩니다. 기본 지역이 다시 온라인 상태가 되면 VM에 대한 장애 복구 복제를 설정할 수 있습니다. 이때 사이트 복구 서비스에서는 원본 디스크가 아직 사용 가능한지 확인합니다. 존재하는 경우 일관성을 확인하고 복제할 누락된 변경 사항을 결정합니다. 디스크가 없으면 전체 디스크의 복제가 시작됩니다.
- 장애 조치와 동일한 방식으로 장애 복구를 수행하고 적절한 가동 중지 시간이 있을 때마다 수행할 수 있습니다.

테스트 및 계획된 장애 조치
- ASR은 테스트 및 계획된 장애 조치 옵션을 지원합니다. 각 옵션은 다양한 시나리오에서 유용합니다.
- 테스트 장애 조치(Test failover)에서 ASR은 복제된 데이터를 사용하여 사용자가 정의한 테스트 네트워크에 VM을 생성합니다. 테스트 애플리케이션에서 기본 데이터베이스로의 실수로 쓰기 또는 기타 예상치 못한 문제를 방지하려면 기본 네트워크에 연결하지 않고 격리된 테스트 네트워크를 설정하는 것이 좋습니다. 테스트 VM은 복제 데이터에 대한 쓰기 작업을 커밋하지 않습니다. 이를 통해 어떤 방식으로든 기본 서버나 복제에 영향을 주지 않고 테스트 VM을 변경할 수 있습니다(예: 애플리케이션 또는 데이터베이스 업그레이드). 애플리케이션 또는 데이터베이스 업그레이드 테스트를 수행하거나 규정 준수 청각 이유로 보조 지역에서 필요에 따라 테스트 장애 조치(failover)를 수행하여 VM 및 해당 워크로드 장애 조치(failover)의 유효성을 검사할 수 있습니다. 테스트가 끝나면 테스트 환경을 간단히 정리할 수 있습니다. 테스트 VM 및 연결된 디스크는 보조 Azure 지역에서 삭제되는 반면 원본 복제는 방해받지 않고 계속됩니다.
- 계획된 장애 조치(failover) 중에 ASR은 VM을 보조 지역에서 온라인으로 가져오고 VM에 대한 변경 사항이 디스크에 커밋되도록 허용합니다. 변경 내용이 주 지역에 복제되지 않는 동안 기본 사이트에서의 복제는 중지됩니다. 기본 VM이 다운되었거나 보조 지역으로 마이그레이션하는 시나리오에서 이 옵션을 사용하세요.

네트워크 보안
- 원본 Azure 지역의 NSG(네트워크 보안 그룹)를 사용하여 아웃바운드 복제 트래픽을 제어할 수 있습니다. ASR에서는 모든 NSG 규칙 설정이 아웃바운드 복제 트래픽을 활성화해야 합니다. Microsoft가 제공하는 서비스 태그를 사용하여 이러한 아웃바운드 트래픽 규칙을 정의할 수 있습니다. 이렇게 하면 Microsoft 서비스의 모든 IP 변경 사항이 사용자 환경에 자동으로 적용됩니다. 변경 사항이 발생할 때 Microsoft에서 서비스 태그를 업데이트하여 워크로드에 대한 중단 없는 복제를 지원하기 때문입니다.

##Hyper-V-Azure 재해 복구
- SCVMM(System Center Virtual Machine Manager) 유무에 관계없이 Hyper-V를 사용하는 회사는 ASR을 사용하여 Azure에서 온-프레미스 환경에 대한 재해 복구를 설정하는 이점을 누릴 수 있습니다. ASR과 관련된 비용과 Hyper-V 및 SCVMM과의 포괄적인 통합을 고려하면 모든 규모의 조직에 이상적인 솔루션입니다.
- 과거에는 재해 복구(DR) 사이트를 설정한다는 것은 다른 데이터 센터에서 인프라를 호스팅하고 각 인프라 계층에 대한 모든 관련 네트워킹 구성 요소, 업그레이드 및 업데이트를 지속적으로 관리하는 것을 의미했습니다. 이러한 설계의 초기 설정 및 지속적인 유지 관리 비용으로 인해 대부분의 중소기업에서는 DR 사이트 설정을 기피하고 대신 복구 전략을 위해 오프사이트 백업에 의존했습니다. 그러나 오늘날에는 비용상의 이점과 관리 및 유지 관리의 용이성 덕분에 모든 조직이 ASR의 이점을 누릴 수 있습니다.
- ASR은 Windows Server 2012 R2(최신 업데이트 포함)부터 최신 Windows Server 릴리스까지 Hyper-V 호스트를 지원합니다. 마찬가지로 VMM의 경우 지원되는 최소 버전은 Virtual Machine Manager 2012 R2부터 최신 릴리스까지입니다.
- Hyper-V VM의 경우 Azure에서 호스팅이 지원되는 모든 VM을 복제할 수 있습니다. 따라서 Hyper-V 호스트, VMM 서버 및 Hyper-V VM에 대한 최신 지원 매트릭스와 관련하여 온라인에 게시된 Microsoft의 최신 지침을 확인하는 것이 중요합니다. 이 지침은 다양한 운영 체제의 수명이 종료되거나 지원이 종료됨에 따라 수시로 변경됩니다.
- ASR은 SharePoint, Exchange, Dynamics, SQL Server, Active Directory 등의 Microsoft 애플리케이션과 통합되며 Oracle, SAP, IBM, Red Hat 등의 주요 공급업체와 긴밀하게 협력합니다.

복제 구성요소
- ASR은 Hyper-V 환경에 따라 다양한 구성 요소를 사용합니다.
    - **VMM이 포함된 Hyper-V / VMM이 포함된 Hyper-V 클러스터**: 이 시나리오에서는 VMM 서버에 ASR Provider 에이전트를 배포하고 각 Hyper-V 호스트에 Recovery Services 에이전트를 배포합니다. Hyper-V VM에는 아무것도 설치할 필요가 없습니다.
    - **VMM이 없는 Hyper-V / VMM이 없는 Hyper-V 클러스터**: 이 시나리오에서는 각 Hyper-V 호스트에 ASR Provider 에이전트와 Recovery Services 에이전트를 배포합니다. Hyper-V VM에는 아무것도 설치할 필요가 없습니다.
- 각 시나리오에서는 복제 설정 중에 참조하기 위해 동일한 Azure 지역에 Recovery Services 자격 증명 모음, 스토리지 계정 및 가상 네트워크를 프로비전해야 합니다. 복제는 30초마다(프리미엄 스토리지를 복제에 사용하는 시나리오 제외) 자주 설정하거나 5분마다 드물게 설정할 수 있으므로 매우 낮은 복구 지점 목표와 낮은 데이터 손실을 달성할 수 있습니다.
- LRS 및 GRS 스토리지 계정 유형이 지원되지만 복제된 데이터가 여러 Azure 지역에서 유지 관리되도록 하려면 비용이 허용되는 경우 GRS를 사용하는 것이 좋습니다. 이렇게 하면 온-프레미스 중단이 발생할 때 기본 Azure 지역도 다운된 경우 보조 지역에서 장애 조치(failover)를 시작할 수 있습니다.
- 온프레미스에서의 초기 복제는 네트워크를 통해 수행되어야 합니다. 초기 데이터 또는 후속 데이터 전송에 대한 오프라인 복제는 지원되지 않습니다.

복제 정책(Replication policy)
- Azure 간 복제와 마찬가지로 DR 설정 프로세스 중에 복제 정책을 만들고 이를 복제 구성과 연결해야 합니다. 여기에는 다음 옵션 설정이 포함됩니다.
    - **복사 빈도(Copy Frequency)**:초기 복제가 완료된 후 델타 동기화가 발생하는 빈도를 정의합니다. 옵션 범위는 30초에서 5분입니다.
    - **복구 지점 보존(Recovery Point Retention)**: 이는 정의한 보존 일정에 따라 서비스가 복구 지점을 유지하므로 ASR이 복구를 허용하는 기간을 정의합니다. 현재 지원되는 최대 복구 지점 보존 기간은 24시간입니다.
    - **앱 일치 복구 지점(App-Consistent Recovery Points)**: 메모리에서 실행되는 모든 프로세스, 데이터 및 트랜잭션과 함께 디스크에 있는 데이터의 스냅샷입니다. Windows 서버의 볼륨 섀도 복사본 서비스를 사용하여 캡처됩니다. 앱 일치 스냅샷은 충돌 일치 스냅샷보다 시간이 더 오래 걸리며 정의된 사용 가능한 리소스 및 빈도에 따라 서버에 로드를 추가할 수 있습니다. 이러한 스냅샷으로 인해 상당한 오버헤드가 발생하지 않는지 테스트하거나 추가 로드를 수용할 수 있도록 VM 워크로드 크기를 조정해야 합니다. 이 스냅샷에 지원되는 최소 빈도는 1시간입니다.
- 구성이 완료되면 복제를 즉시 초기화할지 또는 나중에 시작되도록 예약할지 정의할 수도 있습니다.

<img src="https://drive.google.com/uc?id=1UHlkz2Jx3tdEP2HkAxYbZ8-0moB3kcAo">

- VMM이 포함된 Hyper-V / VMM 토폴로지가 포함된 Hyper-V 클러스터.

<img src="https://drive.google.com/uc?id=1YZR0xCwnQJyEFkBVX1zKCAh3Ev6QccMu">

- VMM이 없는 Hyper-V / VMM 토폴로지가 없는 Hyper-V 클러스터.

데이터 보안
- Azure-Azure DR 시나리오와 유사하게 ASR은 온-프레미스와 Azure 대상 지역 간에 전송되는 데이터를 가로채거나 검색하거나 분석하지 않습니다. 이는 전체 프로세스를 서비스에 투명하게 만들고 복제된 데이터가 악의적인 목적으로 사용될 위험을 제거합니다. ASR은 복제 상태를 모니터링하고 장애 조치 활동을 조정하기 위한 메타데이터 정보만 얻습니다. 데이터는 전송 중에 암호화될 뿐만 아니라 대상 지역에 저장될 때 저장 중에도 암호화됩니다.

장애 조치 및 장애 복구(Failover and failback)
- 온-프레미스 Hyper-V 환경에 재해가 발생한 경우 ASR 서비스를 사용하여 Azure VM을 대상 지역으로 장애 조치할 수 있습니다. 복원에 사용할 복구 지점을 선택하라는 메시지가 표시됩니다. 그러면 정의한 설정과 복제된 데이터를 기반으로 대상 VM이 생성됩니다.
- 대상 VM이 보호되지 않은 상태로 생성됩니다. 온-프레미스 데이터 센터가 다시 온라인 상태가 되면 Azure에서 온-프레미스 Hyper-V 호스트로 VM에 대한 장애 복구 복제를 설정할 수 있습니다. 이때 ASR이 원본 디스크의 일관성을 확인하고 복제할 누락된 변경 사항을 결정하는 델타 동기화를 수행하거나, 이것이 불가능할 경우 전체 다운로드 옵션을 선택하여 전체 파일을 다운로드하도록 선택할 수 있습니다. 디스크는 Azure에서 다시 온-프레미스로 복제됩니다. (대부분의 Azure VM이 며칠 동안 실행된 경우 장애 복구를 설정하려면 전체 다운로드 옵션을 수행해야 합니다.) 일단 복제되면 필요할 때마다 장애 조치와 동일한 방식으로 장애 복구를 수행할 수 있습니다. 적절한 가동 중지 시간이 제공됩니다.

테스트, 계획된 장애 조치 및 계획되지 않은 장애 조치
- Azure 간 재해 복구와 마찬가지로 ASR은 Azure에 복제되는 Hyper-V VM에 대해서도 테스트 및 계획된 장애 조치(failover) 옵션을 지원합니다. 또한 Azure에 대한 정상적인 장애 조치(failover)를 수행할 수 있는 기능을 제공하지 않고 기본 사이트가 오프라인 상태가 된 경우 계획되지 않은 장애 조치(failover)를 지원합니다.
- 테스트 장애 조치(failover)에서 ASR은 해당 Hyper-V VM에 대한 복제된 데이터를 사용하여 사용자가 정의한 테스트 네트워크에 VM을 생성합니다. 테스트 애플리케이션에서 기본 데이터베이스로의 실수로 쓰기 또는 기타 예상치 못한 문제를 방지하려면 기본 네트워크에 연결하지 않고 격리된 테스트 네트워크를 설정하는 것이 좋습니다. 테스트 VM은 복제 데이터에 대한 쓰기 작업을 커밋하지 않습니다. 이를 통해 어떤 방식으로든 기본 서버나 복제에 영향을 주지 않고 테스트 VM을 변경할 수 있습니다(예: 애플리케이션 또는 데이터베이스 업그레이드). 애플리케이션 또는 데이터베이스 업그레이드 테스트를 수행하거나 규정 준수 청각상의(auditory) 이유로 Azure에서 필요에 따라 테스트 장애 조치(failover)를 수행하여 VM 및 해당 워크로드 장애 조치(failover)의 유효성을 검사할 수 있습니다. 이는 온프레미스 리소스가 부족하고 애플리케이션 변경 사항을 빠르게 검증하기 위해 임시 테스트 환경이 필요한 시나리오에서도 도움이 될 수 있습니다. 테스트가 끝나면 테스트 환경을 간단히 정리할 수 있습니다. 테스트 VM 및 관련 디스크는 Azure에서 삭제되지만 원래 온-프레미스 복제는 방해받지 않고 계속됩니다.
- 계획된 장애 조치(failover) 중에 ASR은 온-프레미스 Hyper-V에서 최종 델타 동기화를 수행하여 모든 변경 사항이 Azure에 복제되도록 합니다. 그런 다음 대상 구성을 기반으로 VM이 구축되고 정의된 Azure 지역에서 온라인으로 전환됩니다. VM을 사용하면 변경 사항을 디스크에 커밋할 수 있습니다. 변경 사항이 주 지역에 복제되지 않더라도 기본 사이트에서의 복제는 중지되고 장애 조치(failover)가 시작되기 전에 기본 VM이 종료됩니다. 온-프레미스에서 Azure로 마이그레이션하는 경우 시나리오에서 이 옵션을 사용하세요.
- 온프레미스 환경이 이미 오프라인인 경우 계획되지 않은 장애 조치(failover)를 수행해야 합니다. 이러한 시나리오에서 ASR은 온프레미스 VM에서 최종 변경 사항을 복제할 수 없습니다. 그러나 이미 복제된 복구 지점 중 하나를 선택할 수 있습니다.

네트워크 요구 사항
- ASR은 주로 공용 인터넷을 사용하여 데이터를 Azure Storage 공용 엔드포인트에 직접 복제합니다. 복제는 SSL을 통해 이루어지므로 전송 중에 데이터가 보호됩니다. P2S(지점-사이트) 또는 S2S(사이트-사이트) VPN을 통한 복제는 현재 지원되지 않습니다. 데이터 전송이 이루어지려면 Hyper-V 호스트가 인터넷을 통해 Azure Storage 엔드포인트에 액세스할 수 있는지 확인해야 합니다.
- P2S 및 S2S 연결은 지원되지 않지만 ASR은 온-프레미스에서 DR 사이트를 호스팅하는 Azure 데이터 센터로의 ExpressRoute 연결을 통한 복제를 지원합니다. 이 기능이 작동하려면 Microsoft 피어링과 함께 ExpressRoute를 사용하려면 복제 로그를 저장하는 데 사용되는 Azure Storage를 설정해야 합니다.

##복구 계획(Recovery plans
- 복구 계획은 오케스트레이션된 방식으로 함께 장애 조치할 상호 연결되고 상호 의존적인 VM 그룹을 정의하는 데 도움이 됩니다. 또한 다른 서비스가 온라인 상태여야 하는 상호 의존적인 VM을 온라인으로 전환하기 전에 분리하여 다른 그룹으로 구성하고 그에 따라 순서를 지정할 수도 있습니다.
- 현재 ASR은 최대 7개의 그룹 생성을 지원하며, 단일 복구 계획으로 최대 100개의 보호되는 VM을 관리할 수 있습니다. VM이 더 많은 경우 여러 복구 계획을 정의해야 합니다. 또한 다른 VM에서 실행되는 서비스에 대한 종속성을 기반으로 복구 계획 내에서 VM을 연결할 올바른 그룹을 계획하고 식별해야 합니다. 예를 들어 데이터베이스에 연결하려고 할 때 애플리케이션 서비스에서 오류가 발생하지 않도록 애플리케이션 VM을 온라인으로 전환하기 전에 데이터베이스 VM을 온라인으로 전환하려고 합니다. 마찬가지로, 네트워크에 활성 DC가 없으면 AD 서비스 계정을 사용하여 실행 중인 SQL 서비스가 실패하기 때문에 데이터베이스 서버를 온라인으로 전환하기 전에 Active Directory 및 DNS 서비스를 온라인으로 전환하려고 합니다.
- 복구 계획은 Azure로의 장애 조치(failover)와 Azure에서의 장애 복구(failback) 모두에 도움이 됩니다. 또한 스크립트를 사용하여 그룹을 온라인으로 전환하기 전후에 추가 활동을 수행할 수 있습니다. 여기에는 방화벽, NAT 게이트웨이, 애플리케이션 게이트웨이 등과 같은 다른 Azure 리소스 생성이나 일련의 활동을 수행하는 Runbook 트리거가 포함될 수 있습니다.
- 동일한 VM이 여러 복구 계획의 일부일 수 있습니다. 복구 계획이 트리거되는 순서에 따라 한 복구 계획의 VM이 이미 온라인 상태인 경우 후속 계획은 해당 시퀀스 동안 이를 무시합니다.
- 복구 계획을 사용하면 다음과 같은 이점이 있습니다.
    - Azure에서 VM의 구조화된 활성화를 지원합니다.
    - 상호 의존적이거나 연결된 서비스를 정상적으로 온라인으로 가져올 수 있습니다.
    - 방화벽, WAF, NSG, 공용 IP 등과 같은 기타 종속 서비스는 병렬로 구축할 수 있으며 사전 프로비저닝할 필요가 없으므로 비용이 절감됩니다.
    - 작업 자동화(Task automation)를 지원하여 전체 복구 시간을 단축합니다.
    - 수동 개입 없이 장애 조치 후 VM이 필요에 따라 작동하는지 확인하기 위해 장애 조치를 테스트하는 데 사용할 수 있습니다.

##모범 사례
- **서비스 태그를 사용하여 네트워크 보안 규칙의 복잡성을 줄이기**: 서비스 태그는 Azure 서비스와 관련된 트래픽 규칙을 관리하는 좋은 방법입니다. ASR 서비스와의 통신에 잠재적으로 영향을 미칠 수 있는 서비스 변경 사항을 추적하고 유지 관리하는 관리 오버헤드를 줄이려면 가능할 때마다 서비스 태그를 사용하십시오.
- **RBAC ASR 역할 사용**: Azure는 서비스에 대한 액세스를 세부적으로 제어할 수 있도록 특별히 ASR을 위한 세 가지 RBAC 역할을 제공합니다. 이러한 역할을 사용하여 사용자 환경에서의 관리 활동을 기반으로 관리자에 대한 액세스를 제한합니다. 이러한 역할에는 다음이 포함됩니다.
- **Site Recovery 기여자**: 이 역할은 ASR 구성 요소 및 작업에 대한 모든 액세스를 제공합니다. DR 환경 유지 및 관리를 담당하는 DR 관리자에게 권장됩니다.
- **사이트 복구 운영자(Site Recovery Operator)**: 이 역할은 장애 조치 및 장애 복구 작업 시작에 대한 액세스를 제한합니다. DR 관리자 부재시 DR 장애 조치 및 장애 복구를 담당하는 관리자에게 권장됩니다.
- **사이트 복구 리더(Reader)**: 이 역할은 ASR 구성 및 관리 작업 보기에 대한 액세스를 제한합니다. DR 환경 모니터링을 담당하지만 추가 관리 작업을 수행하지 않는 관리자에게 권장됩니다.
- **테스트 장애 조치 기능(Test failover functionality) 사용**: ASR의 테스트 장애 조치 옵션은 애플리케이션 업데이트 및 업그레이드를 테스트하고 실제 DR 작업을 트리거해야 하기 전에 DR이 예상대로 작동하는지 검증하는 좋은 방법입니다. DR 계획이 의도한 대로 작동하는지 확인하려면 이 기능을 한 번 이상 사용하세요.
- **정기적인 DR 훈련 수행**: 관리자와 비즈니스 팀이 필요할 때 활성화할 모든 절차를 알 수 있도록 정기적인 DR 훈련을 수행하는 것이 좋습니다. 혼란을 피하기 위해 DR 계획의 다양한 역할과 활동을 명확하게 문서화하세요.
- **Azure-Azure 시나리오에서 가속(Accelerated) 네트워킹 사용**: 가속 네트워킹은 Azure VM에 대한 SR-IOV(단일 루트 I/O 가상화)를 활성화하는 Azure VM에 사용할 수 있는 기능입니다. 이는 네트워크 데이터 경로에서 호스트를 우회하여 VM의 네트워크 성능을 향상시킵니다. 가속화된 네트워킹이 Azure의 VM에 도움이 될 수 있는 경우 ASR 구성의 일부로 보조 Azure 지역의 대상 VM에 대해서도 구성을 설정하세요.
- **복제 구성에서 원치 않는 디스크 제외**: ASR을 사용하면 복제 구성에서 원치 않는 디스크를 제외할 수 있습니다. 이를 통해 Azure 측의 스토리지 사용량을 줄이고 대역폭 사용량이 최적화됨에 따라 복제 속도를 높일 수 있습니다. 이러한 디스크의 예로는 SQL Server tempdb 디스크와 Windows VM의 페이징 파일 디스크가 있습니다.
- **성능을 위해 앱 일치 백업 모니터링**: 가능한 한 애플리케이션에 대해 앱 일치 백업을 사용하되 스냅샷 빈도와 관련된 영향에 대해 온프레미스 환경을 모니터링해야 합니다. 해로운 영향이 발견되면 온프레미스 워크로드에 대한 리소스를 늘리거나 스냅샷 빈도를 줄여야 할 수 있습니다.
- **각 고유 애플리케이션에 대한 복구 계획 수립**: 해당 애플리케이션에 대해 여러 서버를 온라인에 배치해야 하는 경우 각 고유  애플리케이션에 대한 복구 계획을 작성하는 것이 좋습니다. 이를 통해 필요할 때 테스트를 위해 개별 애플리케이션을 온라인으로 가져올 수 있습니다. 또한 각 복구 계획 내에서 각 애플리케이션에 독점적으로 필요한 스크립트와 단계를 포함시키는 데 도움이 되므로 정기적으로 이를 더 쉽게 추적하고 관리할 수 있습니다.
