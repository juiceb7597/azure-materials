#제 9장 Azure Bastion

##개요
- Azure Bastion은 사용자가 HTML5 기반 웹 브라우저를 사용하여 Azure에서 호스팅되는 Windows 및 Linux VM(가상 머신)에 안전하게 액세스할 수 있도록 Microsoft에서 제공하는 완전 관리형 PaaS(Platform as a Service)입니다. 완전 관리형 보안 서비스인 Azure Bastion을 사용하면 Azure에서 VM을 공개적으로 노출할 필요가 없습니다.
- Azure Bastion은 RDP 또는 SSH 프로토콜을 통해 TLS를 통해 Azure Portal에서 Azure에서 호스팅되는 VM에 직접 보안 액세스를 제공합니다. VM에는 RDP/SSH 액세스가 작동하기 위해 에이전트나 사용자 지정 소프트웨어를 설치할 필요가 없습니다.
- Azure Bastion을 설정하고 사용하는 것은 매우 쉽습니다. 이렇게 하면 중요한 인프라 구성 요소, 즉 VM이 공개적으로 직접적으로 노출되는 것을 줄여 전반적인 네트워크 보안을 향상할 수 있습니다.

##Azure Bastion 기능
- **Azure 포털을 통한 직접 RDP/SSH 액세스**: Azure Bastion을 사용하면 해당 VM을 공개적으로 노출하지 않고도 HTML5 기반 웹 브라우저 내에서 직접 Azure 포털을 사용하여 Windows 및 Linux VM에 액세스할 수 있습니다.
- **Azure VM의 퍼블릭 노출 감소**: Azure Bastion을 사용하면 원격 액세스용으로 설정된 VM에서 공용 IP를 제거할 수 있습니다. 이 서비스는 VM의 내부 IP를 통해 관리 목적으로 필요한 RDP/SSH 연결을 제공하므로 관리를 위한 네트워크의 유일한 진입점이 됩니다.
- **대부분의 네트워크와 호환**: Azure Bastion은 포트 443을 통해 안전하게 작동하므로 대부분의 회사 방화벽을 통해 액세스할 수 있습니다. 추가 보안을 제공하고 보안 액세스를 위해 네트워크 방화벽에 추가 포트를 노출하기 위해 RDP/SSH 세션을 사용자 지정 포트로 리디렉션할 필요가 없습니다.
- **VM에서 파일 데이터 전송 없음**: Azure Bastion은 RDP/SSH 세션을 통해 VM에서 파일이 복사되거나 전송되는 것을 방지합니다. 텍스트 복사 및 붙여넣기만 지원됩니다. 이렇게 하면 원치 않는 데이터 손실 위험이 제거됩니다.
- **고객 데이터 관리**: Azure Bastion은 클라이언트 데이터가 서비스가 배포된 지역 밖으로 저장되거나 이동되지 않도록 보장하여 엄격한 데이터 지역화 규칙을 준수해야 하는 조직에 추가적인 데이터 보안을 제공합니다.
- **액세스를 위한 특별한 소프트웨어나 에이전트가 필요하지 않음**: Azure Bastion에는 에이전트나 사용자 지정 소프트웨어를 설치하거나 VM이나 클라이언트 측에 사용자 지정 구성을 설치할 필요가 없습니다.
- **모든 HTML5 기반 브라우저에서 작동**: Azure Bastion은 Windows 및 macOS를 포함한 모든 운영 체제를 통해 액세스할 수 있도록 Microsoft Edge 및 Google Chrome과 같은 HTML5 기반 웹 브라우저의 사용을 지원합니다.
- **복잡한 NSG의 필요성 제거**: Azure Bastion에서는 관리 목적으로 VM을 공개적으로 노출할 필요가 없으므로 특정 IP 범위, 사용자 지정 포트 등을 통해 VM에 안전하게 액세스하기 위해 복잡한 NSG가 필요하지 않습니다. Azure Bastion은 해당 서브넷에서 RDP/SSH 액세스만 열어서 사용할 수 있어야 합니다.
- **네트워크 노출 감소**: VM은 인터넷에 직접 노출되지 않기 때문에 공격자는 관리 목적으로 열려 있는 포트를 식별하기 위해 외부 네트워크에서 포트 검색과 같은 악의적인 활동을 수행할 수 없습니다.
- **제로데이 공격에 대한 노출 감소**: 완벽하게 관리되는 PaaS인 Bastion은 경계 보안을 제공합니다. Microsoft는 서비스 강화 및 패치를 통해 백엔드 구성 요소를 보호하여 최신 상태로 유지합니다.
- **가상 네트워크 및 피어링된 네트워크에서 작동**: Azure Bastion은 배포된 가상 네트워크에서 호스팅되는 모든 VM에 대한 보안 액세스를 제공합니다. 또한 피어링된 가상 네트워크에 대한 보안 액세스를 제공하므로 서로 다른 네트워크에 대해 서비스의 여러 인스턴스를 만들 필요가 없습니다.
- **원격 IT 관리 시나리오에 적합**: Azure Bastion은 IT 관리자에게 어디서나 Azure 기반 VM에 대한 보안 액세스를 제공하여 안전한 원격 관리를 가능하게 합니다. 또한 관리 목적으로만 액세스하는 한 원격 데스크톱 서비스에 대한 라이선스를 확보하지 않고도 원격 액세스를 허용합니다.

Azure Bastion 제한 사항
- VM 간에 파일을 복사할 수 없습니다. 이는 구성 가능한 설정이 아니기 때문에 조직의 요구 사항에 따라 서비스의 이점이 될 수도 있고 제한 사항이 될 수도 있습니다.
- Azure AD에 조인된 VM에는 Azure Bastion이 지원되지 않습니다.
- Azure Bastion 서브넷은 사용자 정의 라우팅을 지원하지 않습니다.
- Azure Bastion은 현재 IPv6 사용을 지원하지 않습니다.
- Azure Bastion 서비스를 호스팅하는 서브넷은 다른 서비스 배포에 사용할 수 없습니다.
- Azure Bastion이 Azure의 VM에 RDP를 제공하더라도 RDP를 통해 지원되는 표준 시간대 리디렉션은 Azure Bastion을 통해 지원되지 않습니다. 시간대는 VM에 정의된 시간대로 설정됩니다.
- Azure Bastion VM은 미국 영어 QWERTY 키보드 레이아웃만 지원합니다. (다른 지역에 대한 지원은 계속 진행 중입니다.)

##설계 개념 및 배포 고려 사항
아키텍처
- 대부분의 환경에서 원격 관리 활동에는 관리 네트워크, 점프 서버 및/또는 공개적으로 노출된 VM을 사용해야 합니다. 이는 네트워크를 불필요한 위험과 악의적인 공격에 노출시킵니다. 결과적으로 노출된 VM은 정기적으로 패치를 적용하고 강화하여 공격 표면을 줄여야 합니다. 환경의 VM 수가 증가하고 더 많은 가상 네트워크가 상호 연결됨에 따라 네트워크 아키텍처의 복잡성과 이를 안전하게 유지 관리하는 데 필요한 시간이 증가합니다.
- Azure Bastion은 안전한 중앙 집중식 관리 서비스 계층 배포를 허용하여 VM 관리 네트워크 아키텍처의 복잡성을 줄입니다. 이 계층은 기본 계층이 기본적으로 강화되고 보안 및 최신 상태로 유지되도록 보장하면서 VM에 대한 RDP/SSH 연결을 제공합니다.
- Azure Bastion을 사용하여 Azure의 피어링된 네트워크에서 VM에 액세스하면 관리 네트워크 계층의 설계가 단순화되어 공격 표면이 줄어들면서 Azure 지역의 중단을 관리하기 위한 중복성이 허용됩니다. 그림에서는 Azure Bastion 서비스를 사용하여 Azure Portal을 통한 클라이언트 세션에서 VM 액세스를 활성화하는 방법을 보여줍니다.

<img src="https://drive.google.com/uc?id=1yIHpAdS4E2N8D1EMeMjPJVJFYQUN-VVp">

SKUs
- Azure Bastion은 기본 및 표준이라는 두 가지 SKU를 제공합니다. 기본 SKU가 두 개의 호스트만 지원한다는 점을 제외하면 둘 다 현재 동일한 기능을 제공합니다.

고가용성 호스트
- 기본적으로 Azure Bastion은 프로비전되면 인스턴스 오류가 발생할 경우 중복성을 제공하는 두 개의 보안 인스턴스를 만듭니다. 각 Azure Bastion 인스턴스는 연결에서 생성된 전체 부하에 따라 10~12개의 동시 RDP/SSH 연결을 지원합니다. 표준 SKU에서는 호스트를 2개 이상으로 확장할 수 있습니다.

가상 네트워크 피어링
- 서로 다른 가상 네트워크가 함께 피어링되는 경우 그 중 하나만 Azure Bastion을 배포하여 서로 다른 가상 네트워크의 VM에 액세스할 수 있습니다. 이 작업을 수행하려면 사용자 또는 관리자에게 가상 네트워크에 대한 독자 권한(최소)이 필요합니다.
- Azure Bastion은 다음과 같은 두 가지 유형의 피어링을 지원합니다.
    - 지역(Regional) 피어링을 통해 피어링된 가상 네트워크 중 하나에 있는 Azure Bastion 호스트가 동일한 Azure 지역에 있는 모든 피어링된 네트워크의 VM에 연결할 수 있습니다.
    - 글로벌 피어링을 통해 피어링된 가상 네트워크 중 하나에 있는 Azure Bastion 호스트가 모든 글로벌 피어링 네트워크의 VM에 연결할 수 있습니다.

재해 복구
- Azure Bastion 서비스에 대한 재해 복구를 관리해야 합니다. Azure Bastion은 생성된 Azure 지역에 중복 배포되지만 해당 지역에 중단이 발생하면 서비스를 사용할 수 없습니다.
- 이 문제를 해결하는 방법에는 두 가지가 있습니다.
    - **VM 리소스가 실행 중인 다른 Azure 지역의 다른 가상 네트워크에 Azure Bastion을 미리 배포**: Azure Bastion은 전체 메쉬 설계를 지원하기 때문에 기본 지역에 운영 중단이 발생할 경우 가장 가까운 Azure 지역의 Azure Bastion 호스트로 전환할 수 있습니다.
    - **기본(primary) 지역에서 Azure Bastion 서비스가 실패한 후 다른 Azure 지역에 Azure Bastion을 배포**: Azure Bastion을 설정하는 데 시간이 오래 걸리지 않습니다. 즉, 기본 지역에 중단이 발생한 후 다른 지역에서 빠르게 수행할 수 있습니다. 이 접근 방식은 항상 추가 Azure Bastion 호스트를 실행할 필요가 없으므로 비용 효율적입니다.

서비스 요구 사항
- **Azure Bastion 서비스를 호스팅하기 위한 전용 서브넷**: 가상 네트워크에 Azure Bastion 서비스를 배포하기 전에 전용 서브넷을 설정해야 합니다. 이 서브넷은 다음 요구 사항을 충족해야 합니다.
    - 서브넷은 Azure Bastion 배포와 동일한 리소스 그룹 및 가상 네트워크에 있어야 합니다.
    - 서브넷 이름은 AzureBastionSubnet으로 지정되어야 합니다. 그렇지 않으면 Azure Bastion 서비스를 만들 때 Bastion 만들기 마법사(Create a Bastion wizard)에서 인식되지 않습니다.
    - 서브넷 옥텟은 /27 이상(/26, /25 등)이어야 합니다.
    - 서브넷은 Azure Bastion을 호스트하는 데에만 사용해야 합니다. 다른 리소스를 호스팅할 수 없습니다.
- **공용 IP 주소**: Azure Bastion 서비스에는 전용 공용 IP 주소를 할당해야 합니다. 이 공용 IP 주소는 다음 요구 사항을 충족해야 합니다.
    - 공용 IP 주소는 정적 할당(동적 할당 아님)으로 설정되어야 합니다.
    - 공용 IP 주소는 표준 SKU여야 합니다.
    - Azure Bastion 서비스를 만들 때 이러한 기준을 충족하는 기존의 사용되지 않은 공용 IP를 사용할 수 있습니다.
- **액세스 권한**: Azure Bastion 서비스를 사용하여 VM에 연결하는 사용자 또는 관리자는 Azure 환경에서 최소한 다음과 같은 권한이 있어야 합니다.
    - VM의 리더 역할
    - VM의 프라이빗 IP를 사용하는 NIC의 리더 역할
    - Azure Bastion 리소스에 대한 독자 역할
    - 해당 가상 네트워크가 피어 서비스 요구 사항인 경우 가상 네트워크에 대한 독자 역할


##모범 사례
- **필수 네트워크 포트만 허용**: Azure Bastion에는 최종 사용자에서 Azure에서 호스팅되는 VM으로의 수신 및 송신 트래픽을 허용하기 위해 제한된 수의 포트가 필요합니다. 포트 요구 사항은 다음과 같습니다.
    - **클라이언트/관리자의 수신(Ingress) 트래픽**: 인터넷에서 Azure Bastion 공용 IP로 연결하려면 포트 443만 필요합니다. 다른 포트는 필요하지 않습니다.
    - **Azure VM에 대한 송신(Egress) 트래픽**: Azure Bastion 서브넷과 VM을 호스팅하는 서브넷 사이에는 RDP(3389) 및 SSH(22)용 포트만 필요합니다.
    - **다른 Azure 서비스로의 송신(Egress) 트래픽**: Azure Bastion은 포트 443을 사용하여 로그 저장을 위해 Azure Storage와 같은 다른 Azure 서비스에 연결합니다. Azure Bastion의 모든 Azure 리소스에서 올바르게 작동할 수 있도록 AzureCloud 서비스 태그에 대해 포트 443에 대한 아웃바운드 액세스를 활성화합니다.
- **액세스 인증 및 권한 부여를 위해 Azure Active Directory 사용**: Azure AD(Active Directory)는 Azure의 기본 ID 및 액세스 관리 서비스입니다. 기본적으로 Azure Bastion은 Azure AD와 통합되어 있으며 Azure AD를 사용하여 Azure Bastion 서비스에 대한 사용자 액세스를 제어할 수 있습니다. 사용자 수준에서 Azure AD의 액세스를 제한하거나 리소스 수준에서 Azure AD를 사용하면 리소스에 대한 액세스를 제한하는 데 도움이 될 수 있습니다.
- **Key Vault를 사용하여 SSH 키 저장**: SSH 키를 Key Vault 비밀로 저장하고 Azure Bastion을 사용하여 VM에 로그인하는 데 필요한 관리자에게만 이러한 비밀에 대한 액세스를 허용하는 것이 좋습니다. 이는 이러한 SSH 키의 저장, 관리 및 공유를 중앙 집중화하는 데 도움이 될 수 있습니다.
- **다단계 인증 사용**: Azure Portal에 대한 액세스는 Azure AD와 통합됩니다. Azure Portal에 대한 로그인을 보호하기 위해 또 다른 보안 계층을 추가하려면 MFA(다단계 인증)를 사용하도록 설정할 수 있습니다. 사용자 로그인에 대한 보안을 강화하려면 가능한 한 빨리 이 작업을 수행해야 합니다.
- **모니터링 및 경고 설정**: 진단 로깅을 사용하여 원격 세션을 모니터링하고 사용자 로그인을 추적합니다. 액세스 시간, 액세스 위치 등과 관련된 기준에 따라 경고를 구성하여 의심스러운 액세스 패턴을 기반으로 승인된 네트워크 또는 특정 기간의 액세스를 제한하는 추가 제한을 구현할 수 있습니다.
- **조건부 액세스 정책 사용**: 조건부 액세스 정책을 사용하면 MFA 및 기타 기준을 사용하여 특정 네트워크, 특정 국가에서만 Azure Portal에 액세스할 수 있도록 제한을 적용할 수 있습니다. 조직의 보안 요구 사항에 따라 의심스러운 로그인에 대한 조건부 액세스 정책을 사용하고 추가 보안을 위해 경고를 모니터링할 수도 있습니다.
- **업무상 중요한 시스템에 대한 관리 액세스를 제한**: Azure Bastion은 Azure RBAC(Azure 역할 기반 액세스 제어)를 사용하여 업무상 중요한 시스템을 호스팅하는 VM에 대한 액세스 권한을 부여해야 하는 계정을 지정합니다. 사용자가 특정 작업을 수행하는 데 필요한 권한만 갖도록 하려면 최소 권한의 원칙을 준수해야 합니다. 또한 Active Directory DC(도메인 컨트롤러), 보안 도구, 시스템 관리 도구 등 비즈니스에 중요한 시스템에 대한 관리 액세스 권한이 있는 관리, ID 및 보안 도구에 대한 액세스를 제한해야 합니다. 이러한 보안 시스템을 손상시키는 공격자는 이를 쉽게 무기화하여 중요한 비즈니스 자산을 손상시킬 수 있습니다!
- **사용자 액세스를 정기적으로 검토**: Azure AD 및 리소스 수준에서 원치 않는 액세스를 추출, 검토 및 제거하는 프로세스를 구현하여 필요한 관리자만 Azure Bastion 서비스에 액세스하여 VM에 연결할 수 있도록 합니다.
- **Azure Privileged Identity Management를 사용**: 환경에 너무 많은 관리자 계정이 생성된 경우 경고할 수 있으며 정리를 위해 사용되지 않는 관리자 계정을 식별하고 모니터링할 수 있습니다.
- **권한 있는 액세스 워크스테이션 사용**: 권한 있는 액세스 워크스테이션(Privileged Access Workstations, PAWs)는 장치 침해로부터 보호하기 위해 강화된 격리된 워크스테이션입니다. 그런 다음 이러한 장치는 Azure Portal 및 기타 중요한 리소스에 액세스하는 유일한 장치로 설정됩니다. 관리 목적으로 안전하지 않고 신뢰할 수 없는 장치에서 Azure 환경으로의 액세스를 방지하려면 PAW를 사용하는 것이 좋습니다.
- **Azure Policy 사용**: Azure Policy는 원치 않는 Azure Bastion 리소스 배포를 감사, 감지 및 제한하고 서비스의 네트워크 구성을 모니터링합니다. 이렇게 하면 원치 않는 배포로 인해 Azure 네트워크에서 추가 진입점이 활성화되는 것을 방지할 수 있습니다.
- **필요하지 않은 경우 액세스 제거**: 특정 관리자에게 더 이상 필요하지 않은 경우 특정 VM에 대한 액세스를 제거하는 것이 좋습니다. 권한 요구 사항의 변경이 감지되면 이러한 제거를 자동화하는 프로세스를 구현합니다.
- **Azure 네트워크 활동에 대한 장기 로깅 활성화**: 모니터링, 경고 및 검토를 위해 스토리지 계정에 진단 서비스 로그를 저장하도록 Azure Bastion을 설정할 수 있습니다. 조직의 규정 준수 요구 사항을 고려하여 로그에 대한 보존 구성을 설정하는 것이 좋습니다.


#제 10장 Azure 프라이빗 링크

##개요
- Azure Private Link는 Azure Storage, Azure App Services, Azure SQL Database 등 Azure PaaS 서비스에 액세스하기 위한 보안 프라이빗 연결을 지원합니다. 프라이빗 엔드포인트는 PaaS와 클라이언트의 Azure 가상 네트워크 간의 연결을 제공합니다.
- Azure Private Link를 사용하면 모든 네트워크 트래픽이 대규모 기업 및 소비자 서비스를 연결하는 Microsoft Azure 글로벌 백본을 통과합니다. 이렇게 하면 사용자 소비를 위해 PaaS 서비스를 공용 인터넷에 노출할 필요가 없어져 액세스를 비공개로 유지하고 제어하기가 더 쉬워집니다.
- 내부 사용자나 파트너, 고객 또는 클라이언트에게 Azure Private Link를 사용하여 Azure 호스팅 서비스에 대한 액세스를 제공할 수 있습니다.

##Azure 프라이빗 링크기능
- **강화된 보안**: Azure PaaS 제품에 대한 프라이빗 액세스를 활성화함으로써 Private Link는 Azure에서 호스팅되는 서비스에 대한 액세스 계층의 보안 상태를 강화합니다.
- **향상된 라우팅**: Private Link를 사용하면 트래픽이 공용 인터넷(신뢰할 수 없음) 대신 Microsoft 백본을 통과하므로 Azure 호스팅 서비스에 대한 더 나은 라우팅이 가능합니다.
- **온-프레미스 또는 피어링된 네트워크로부터의 보안**: 액세스 액세스는 온-프레미스 또는 피어링된 가상 네트워크의 리소스에서 이루어질 수 있습니다. 온-프레미스 환경에서 ExpressRoute 및 VPN 터널을 설정하여 Azure에 대한 연결을 제공할 수 있습니다.
- **제한된 액세스**: 프라이빗 엔드포인트를 특정 PaaS 리소스에 연결하여 사용자가 전체 Azure 백 엔드 대신 해당 리소스에만 액세스하도록 허용할 수 있습니다. 이렇게 하면 Private Link 또는 공용 인터넷을 통해 노출되지 않고 Azure에서 호스팅되는 다른 서비스가 노출될 위험이 줄어듭니다.
- **글로벌 상호 연결성(Interconnectivity)**: Private Link를 사용하면 프라이빗 액세스가 필요한 원본 지역에 관계없이 모든 Azure 지역에서 호스팅되는 Azure 서비스에 연결할 수 있습니다.
- **여러 고객을 위한 보안 액세스**: Private Link를 통해 고객은 Azure에서 호스팅되는 서비스에 개인적으로 액세스할 수 있습니다. 고객은 자신의 가상 네트워크에 프라이빗 엔드포인트를 설정하고 이를 사용하여 서비스에 연결할 수 있습니다.
- **일관된 환경**: 서비스가 Azure PaaS인지, 고객 소유인지, 파트너 소유인지에 관계없이 Azure Private Link를 사용하면 일관된 최종 사용자 액세스 환경을 제공합니다.

##설계 개념 및 배포 고려 사항
프라이빗 엔드포인트
- 프라이빗 엔드포인트는 Azure 가상 네트워크에 연결된 네트워크 인터페이스이며 해당 가상 네트워크의 프라이빗 IP 주소가 할당됩니다. 프라이빗 엔드포인트는 다음 서비스에 대한 프라이빗하고 안전한 액세스를 허용합니다.
    - Azure PaaS 제품 프라이빗 엔드포인트를 Azure Storage와 같은 Azure PaaS와 연결할 수 있습니다. 이를 통해 프라이빗 엔드포인트에 할당된 프라이빗 IP 주소를 통한 액세스가 효과적으로 가능해집니다.
    - 고객 소유 서비스 프라이빗 엔드포인트를 표준 Azure 로드 밸런서와 연결하여 고객이 호스팅하는 워크로드에 대한 보안 내부 액세스를 제공할 수 있습니다.

Azure PaaS 제품과 통합
- 프라이빗 엔드포인트의 대상 대상인 Azure PaaS 제품을 Private Link 리소스라고 합니다.
    - Azure Application Insights
    - Azure Database for MySQL
    - Azure Log Analytics
    - Azure App Service
    - Azure Database for PostgreSQL – Single Server
    - Azure Machine Learning
    - Azure Backup
    - Azure Managed Disks
    - Azure Monitor
    - Azure Batch
    - Azure Event Grid
    - Azure Search
    - Azure Container Registry
    - Azure Event Hub
    - Azure Service Bus
    - Azure Cosmos DB
    - Azure IoT Hub
    - Azure SQL Database
    - Azure Data Factory
    - Azure Key Vault
    - Azure Storage (Blob, File, Queue, and Table)
    - Azure Database for MariaDB
    - Azure Kubernetes Service
    - Azure Synapse Analytics

고객 소유 서비스와의 통합
- Azure Private Link는 표준 Azure 로드 밸런서와 연결할 수 있습니다. 내부 Azure 로드 밸런서를 사용하면 Azure 가상 머신과 같은 다른 서비스에서 호스팅되는 서비스 또는 애플리케이션에 대한 액세스가 제공될 수 있습니다.

프라이빗 엔드포인트 기능
- **다양한 네트워크 간 연결**: 프라이빗 엔드포인트를 사용하면 연결된 가상 네트워크, 피어링된 가상 네트워크 및 ExpressRoute 또는 VPN을 사용하여 연결된 온-프레미스 네트워크에 액세스할 수 있습니다.
- **Azure 지역 간 통합**: 한 Azure 지역에서 Private Link 리소스를 호스팅하고 다른 Azure 지역에서 호스팅되는 프라이빗 엔드포인트와 통합할 수 있습니다.
- **읽기 전용 프라이빗 IP**: 모든 프라이빗 엔드포인트에는 서비스에서 구성하고 관리하는 연결된 읽기 전용 네트워크 인터페이스가 있습니다. 네트워크 인터페이스에는 서비스 생성 중에 할당된 개인 가상 네트워크 및 서브넷을 기반으로 IP 주소가 할당됩니다. 이 IP는 프라이빗 엔드포인트가 삭제될 때까지 네트워크 인터페이스에 유지됩니다.
- **Azure 프라이빗 DNS와 통합**: 자동 DNS 레코드 등록 및 관리를 위해 프라이빗 엔드포인트를 Azure 프라이빗 DNS와 통합할 수 있습니다.
- **다중 엔드포인트 상호 연결(Multi-endpoint interconnects) 지원**: 단일 Private Link 리소스를 여러 프라이빗 엔드포인트와 연결할 수 있습니다. 이를 통해 다중 테넌트 시나리오와 같이 분리가 필요한 경우 다양한 IP 네트워크를 통해 리소스에 연결할 수 있습니다.
- **동일한 가상 네트워크에서 여러 프라이빗 엔드포인트 지원**: 모든 가상 네트워크와 서브넷은 여러 프라이빗 엔드포인트를 지원할 수 있습니다. 현재 가상 네트워크당 최대 1,000개의 프라이빗 엔드포인트가 지원됩니다.
- **전용 서브넷이 필요하지 않음**: 프라이빗 엔드포인트에는 가상 네트워크에 전용 서브넷이 필요하지 않습니다. 모든 서브넷을 선택하여 일부 또는 전체 프라이빗 엔드포인트를 호스팅할 수 있습니다.

프라이빗 엔드포인트 제한 사항
- 프라이빗 엔드포인트에 대한 모든 연결은 수신되어야 합니다. 즉, 클라이언트가 리소스에 액세스하려면 프라이빗 엔드포인트에 연결해야 합니다. Azure 리소스에서 온-프레미스 또는 끝점 연결 리소스로 나가는 연결은 지원되지 않습니다.
- 가상 네트워크와 동일한 지역 및 구독을 사용하여 프라이빗 엔드포인트를 배포해야 합니다. 다른 Azure 지역 또는 구독을 사용하는 것은 현재 지원되지 않습니다.
- 프라이빗 엔드포인트에 사용자 정의 라우팅을 사용하면 비대칭 라우팅이 발생할 수 있습니다. 대칭 라우팅이 이루어지도록 하려면 네트워크 가상 어플라이언스에서 이러한 트래픽에 대해 SourceNAT(SNAT)를 설정하는 것이 가장 좋습니다.
- 통합이 작동하려면 Private Link 리소스를 호스팅하는 구독을 Microsoft.Network 리소스 공급자에 등록해야 합니다.

향상된 네트워크 보안
- 프라이빗 엔드포인트는 단일 Private Link 리소스에 매핑되고 해당 리소스에 대한 액세스만 제공합니다. 이를 통해 네트워크 통신을 안전하게 제어하고 관리할 수 있습니다. 사용자가 여러 리소스에 액세스해야 하는 경우 여러 프라이빗 엔드포인트를 배포해야 합니다. 프라이빗 엔드포인트에만 액세스할 수 있도록 Azure 리소스에 대한 퍼블릭 엔드포인트에 대한 액세스를 제한하거나 축소할 수 있습니다.

DNS 구성
- 리소스의 FQDN(정규화된 도메인 이름)을 사용하여 Private Link를 통해 리소스에 액세스하려면 다음 두 가지 사항을 염두에 두어야 합니다.
    - 올바른 프라이빗 IP 주소를 반영하도록 프라이빗 엔드포인트에 대한 DNS 레코드를 업데이트해야 합니다.
    - 프라이빗 DNS 레코드를 사용하려면 프라이빗 엔드포인트에 연결하는 데 사용되는 DNS 서비스를 설정해야 합니다. 그렇지 않으면 공용 엔드포인트를 통해 연결이 계속됩니다. (이는 Azure 가상 네트워크에서 참조되는 DNS 서비스이거나 온-프레미스 리소스에서 사용되는 고객 관리형 DNS 서비스일 수 있습니다.)
- 프라이빗 엔드포인트를 통해 리소스에 액세스하기 위해 DNS를 설정하는 방법에는 여러 가지가 있습니다.
    - **HOSTS 파일 사용**: 프라이빗 엔드포인트에 대한 참조를 포함하도록 HOSTS 파일을 수동으로 설정할 수 있습니다. 이 접근 방식은 테스트 중에 적합합니다. 그러나 이를 대규모로 사용하는 것은 비실용적입니다. 특히 재해 복구 시나리오에서 IP가 변경되는 경우와 같이 구성을 롤아웃하거나 변경할 때 더욱 그렇습니다.
    - **Azure 프라이빗 DNS 영역 사용**: Azure 프라이빗 DNS 영역을 통합하여 프라이빗 엔드포인트에 대한 DNS 이름 확인을 관리할 수 있습니다. 그런 다음 프라이빗 엔드포인트를 사용하여 연결해야 하는 모든 가상 네트워크는 사용자 지정 이름 확인을 위해 프라이빗 DNS 영역을 사용하도록 설정할 수 있습니다.
    - **고객 관리형 DNS 전달자(Forwarders) 사용**: 프라이빗 엔드포인트 도메인에 대한 요청을 서비스에 대한 프라이빗 IP 참조가 있는 DNS 서버로 라우팅하도록 DNS 전달자를 설정할 수 있습니다.

재해 복구
- 기본적으로 프라이빗 엔드포인트에는 99.99% SLA가 제공됩니다. 단, 지역적으로 정전이 발생하는 경우 서비스를 이용할 수 없습니다. 이러한 시나리오를 처리하려면 다음을 수행하는 것이 좋습니다.
    - 서로 다른 Azure 지역의 동일한 Private Link 리소스를 가리키는 여러 프라이빗 엔드포인트를 설정합니다.
    - 프라이빗 엔드포인트와 동일한 지역에 있는 경우 Private Link 리소스에 대한 중복성을 설정하고 재해 복구 계획에서 리소스 장애 조치(failover)를 고려하세요.
- 이 접근 방식은 프라이빗 엔드포인트를 사용하는 고객 워크로드에 영향을 미치는 Azure 지역에서 대규모 재해가 발생할 경우 중복성을 제공합니다.

Azure 프라이빗 링크 서비스
- 서비스 공급자가 고객에게 Azure 호스팅 서비스에 대한 보안 프라이빗 연결을 제공해야 하는 경우 Azure Private Link 서비스를 사용하여 그렇게 할 수 있습니다. Azure Private Link 서비스는 고객이 Azure Private Link를 사용하여 연결할 수 있는 서비스 공급자 호스팅 서비스에 대한 참조를 제공합니다.
- 이 작업이 작동하려면 고객은 Azure 가상 네트워크 내에 프라이빗 엔드포인트를 만들고 이를 Azure Private Link 서비스 별칭 또는 서비스 공급자가 제공하는 리소스 URI에 매핑해야 합니다. 고객 측에서 이 매핑이 완료되면 서비스 공급자는 Microsoft 백본을 통한 트래픽이 허용되기 전에 연결 요청을 자동 승인하거나 수동으로 승인할 수 있습니다.

<img src="https://drive.google.com/uc?id=1tyzs5MFz-tD4VA40v9OUfl5g3Nh4pyEg">

- 고객이 Azure 가상 네트워크에 프라이빗 엔드포인트를 만들고 이를 Private Link 서비스와 연결했습니다.
- Private Link 서비스는 가상 머신 및 가상 머신 확장 집합에서 호스팅되는 백 엔드 서비스 리소스에 대한 모든 트래픽을 프런트 엔드하는 표준 Azure 로드 밸런서에 매핑됩니다.
- 고객은 ExpressRoute를 사용하여 온-프레미스 네트워크를 Azure 환경에 연결했습니다. 이를 통해 온-프레미스 및 Azure에서 호스팅되는 가상 머신의 트래픽이 Microsoft 백본을 통해 서비스 공급자의 Azure 테넌트로 안전하고 비공개적으로 라우팅될 수 있습니다.
- Private Link 서비스에는 전용 서브넷이 필요하지 않습니다. Private Link 리소스가 배포되는 동일한 Azure 가상 네트워크의 모든 서브넷에 배포될 수 있습니다.
- 각 개별 프라이빗 링크 서비스는 여러 프라이빗 엔드포인트에서 연결을 받을 수 있습니다. 그러나 프라이빗 엔드포인트는 하나의 Private Link 서비스에만 연결할 수 있습니다.

서비스 가시성(visibility)
- Private Link 서비스의 노출을 제어하는 세 가지 가시성 옵션이 있습니다. 각 설정은 고객이 서비스에 연결할 수 있는 방법을 제어합니다.
    - **역할 기반 액세스 제어 전용(None)**: RBAC는 동일한 Azure AD 테넌트를 공유하는 가상 네트워크 전체에서 서비스 가시성을 제어하는 데 도움이 됩니다. 테넌트 간 가시성을 설정할 수 있지만 이는 이상적인 방법이 아니며 잘못 수행할 경우 과도한 권한 위임이 발생할 수 있습니다.
    - **구독 제한(Restrictive)**: 신뢰할 수 있는 구독에서 호스팅되는 프라이빗 엔드포인트에서 받은 연결 요청에 대한 액세스를 제공하고 자동 승인을 설정하도록 신뢰할 수 있는 구독을 정의할 수 있습니다.
    - **서비스 별칭이 있는 모든 사람(All)**: 공용으로 설계된 서비스의 경우 누구나 연결을 요청할 수 있도록 이 가시성 옵션을 선택합니다. 연결 요청을 승인하려면 여전히 수동 승인이 필요합니다.

서비스 접근 승인
- **자동 승인**: 서비스 공급자가 신뢰할 수 있는 구독 집합을 미리 정의하거나 프라이빗 엔드포인트를 호스팅하는 경우 모든 연결 요청이 자동으로 승인됩니다.
- **수동 승인**: 서비스 제공자가 트래픽이 허용되기 전에 Private Link 서비스에 대한 액세스를 제어하려는 경우 수동 승인을 설정할 수 있습니다. 이 시나리오에서는 수동 승인이 수행될 때까지 연결 요청이 보류 상태로 유지됩니다.

고가용성
- Private Link 서비스는 서비스당 최대 8개의 IP를 지원합니다. 이는 단일 IP를 통해 연결 문제가 발생할 경우 고가용성을 제공하는 데 사용될 수 있습니다. 또한 여러 Private Link 서비스 표준 로드 밸런를 추가하여 서비스 오류가 발생할 경우 중복성을 제공할 수 있습니다. 현재 각 표준 로드 밸런서는 최대 8개의 Private Link 서비스를 지원합니다.

제한사항
- Private Link 서비스에는 표준 로드 밸런서를 사용해야 합니다. 기본 로드 밸런서는 지원되지 않습니다.
- 표준 로드 밸런의 백 엔드 풀은 VM 또는 VMSS를 가리키도록 구성해야 합니다.
- Private Link는 IPv4 TCP 및 UDP 트래픽만 지원합니다.

##모범 사례
- **사용자 지정 그룹(Custom groups)을 사용하여 액세스 제어**: Private Link 리소스 배포를 위한 권한을 위임해야 하는 경우 소유자, 기여자 또는 네트워크 기여자와 같은 기본 제공 역할 그룹에 대한 액세스를 제공하는 대신 사용자 지정 역할을 사용하여 필요한 권한을 세부적으로 정의하세요. Microsoft는 액세스를 제한하기 위해 사용자 지정 역할 그룹을 만들 수 있도록 역할 권한에 대한 자세한 템플릿을 제공합니다.
- **공유 DNS에 하나의 프라이빗 엔드포인트 사용**: 모든 프라이빗 링크 리소스에 대해 여러 프라이빗 엔드포인트를 만들 수 있습니다. 그러나 DNS 서비스가 모든 엔드포인트에서 공통되는 경우 DNS 레코드 중복이나 충돌로 인해 서비스 중단이 발생하는 것을 방지하기 위해 단일 프라이빗 엔드포인트를 배포하는 것이 가장 좋습니다.
- **활동 로그 및 경고 사용**: Azure 활동 로그를 사용하여 Private Link 리소스에 대한 변경 사항을 모니터링합니다. 원치 않는 활동에 대한 경고를 설정하면 적시에 효과적인 롤백 조치를 취할 수 있습니다.
- **Azure Monitor 사용**: Private Link 리소스에서 생성된 로그를 중앙 집중식으로 모니터링하려면 더 쉽게 분석할 수 있도록 Azure Monitor에 수집합니다. 또한 Log Analytics 작업 영역을 사용하여 데이터를 분석하고, 실행 가능한 통찰력을 도출하고, 서비스에서 생성된 활동 로그 및 보안 로그와 관련된 효과적인 경고를 설정할 수 있습니다.
- **장기 로그 보존 구성**: 조직의 규정 준수로 인해 장기간 활동 및 보안 로그의 저장이 필요한 경우 로그 분석 저장소에 보존 정책을 설정하여 데이터가 필요한 기간 동안 저장되도록 합니다.
- **정기적인 서비스 백업 수행**: Azure Private Link는 서비스 백업을 위해 Azure Backup과 통합되지 않습니다. 그러나 Azure는 Private Link 엔드포인트 및 관련 리소스를 복원하는 데 사용할 수 있는 Private Link 서비스 구성을 템플릿으로 내보내는 기능을 제공합니다. 또한 Azure Automation 및 REST API를 사용하여 정기적인 백업을 수행해야 합니다.
